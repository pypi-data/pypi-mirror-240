"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[70310],{70310:function(e,t,a){a.r(t),a.d(t,{HuiEnergySolarGraphCard:function(){return P}});var r,n,s,i,o=a(68990),d=a(99312),c=a(53709),l=a(81043),u=a(40039),h=a(88962),f=a(33368),p=a(71650),g=a(82390),y=a(69205),v=a(70906),_=a(91808),m=a(27088),k=a(70390),b=a(53970),x=a(24112),Z=a(72277),S=a(59699),C=a(68144),w=a(79932),D=a(83448),M=a(14516),z=a(15838),B=a(89525),E=a(12198),j=a(49684),A=a(18457),O=(a(62336),a(22098),a(55424)),R=a(38014),F=a(73826),P=(0,_.Z)([(0,w.Mo)("hui-energy-solar-graph-card")],(function(e,t){var a,_=function(t){(0,y.Z)(r,t);var a=(0,v.Z)(r);function r(){var t;(0,p.Z)(this,r);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return t=a.call.apply(a,[this].concat(s)),e((0,g.Z)(t)),t}return(0,f.Z)(r)}(t);return{F:_,d:[{kind:"field",decorators:[(0,w.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,w.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,w.SB)()],key:"_chartData",value:function(){return{datasets:[]}}},{kind:"field",decorators:[(0,w.SB)()],key:"_start",value:function(){return(0,m.Z)()}},{kind:"field",decorators:[(0,w.SB)()],key:"_end",value:function(){return(0,k.Z)()}},{kind:"field",decorators:[(0,w.SB)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,w.SB)()],key:"_compareEnd",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:function(){return["_config"]}},{kind:"method",key:"hassSubscribe",value:function(){var e,t=this;return[(0,O.UB)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe((function(e){return t._getStatistics(e)}))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(e){this._config=e}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,C.dy)(r||(r=(0,h.Z)([" <ha-card> ",' <div class="content ','"> <ha-chart-base .hass="','" .data="','" .options="','" chart-type="bar"></ha-chart-base> '," </div> </ha-card> "])),this._config.title?(0,C.dy)(n||(n=(0,h.Z)(['<h1 class="card-header">',"</h1>"])),this._config.title):"",(0,D.$)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd),this._chartData.datasets.length?"":(0,C.dy)(s||(s=(0,h.Z)(['<div class="no-data"> '," </div>"])),(0,b.Z)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):C.Ld}},{kind:"field",key:"_createOptions",value:function(){var e=this;return(0,M.Z)((function(t,a,r,n,s,i){var o=(0,x.Z)(a,t),d=void 0!==s&&void 0!==i;if(d){var c=(0,Z.Z)(a,t),l=(0,Z.Z)(i,s);l>c?a=(0,S.Z)(a,l-c):c>l&&(i=(0,S.Z)(i,c-l))}var h={parsing:!1,animation:!1,interaction:{mode:"x"},scales:{x:{type:"time",suggestedMin:t.getTime(),suggestedMax:a.getTime(),adapters:{date:{locale:r,config:n}},ticks:{maxRotation:0,sampleSize:5,autoSkipPadding:20,font:function(e){return e.tick&&e.tick.major?{weight:"bold"}:{}}},time:{tooltipFormat:o>35?"monthyear":o>7?"date":o>2?"weekday":o>0?"datetime":"hour",minUnit:o>35?"month":o>2?"day":"hour"}},y:{stacked:!0,type:"linear",title:{display:!0,text:"kWh"},ticks:{beginAtZero:!0}}},plugins:{tooltip:{position:"nearest",filter:function(e){return"0"!==e.formattedValue},itemSort:function(e,t){return t.datasetIndex-e.datasetIndex},callbacks:{title:function(e){if(o>0)return e[0].label;var t=new Date(e[0].parsed.x);return"".concat(d?"".concat((0,E.ud)(t,r,n),": "):"").concat((0,j.mr)(t,r,n)," â€“ ").concat((0,j.mr)((0,S.Z)(t,1),r,n))},label:function(e){return"".concat(e.dataset.label,": ").concat((0,A.uf)(e.parsed.y,r)," kWh")},footer:function(t){var a=t.filter((function(e){var t;return"solar"===(null===(t=e.dataset)||void 0===t?void 0:t.stack)}));if(a.length<2)return[];var n,s=0,i=(0,u.Z)(a);try{for(i.s();!(n=i.n()).done;){var o=n.value;s+=o.dataset.data[o.dataIndex].y}}catch(d){i.e(d)}finally{i.f()}return 0===s?[]:[e.hass.localize("ui.panel.lovelace.cards.energy.energy_solar_graph.total_produced",{num:(0,A.uf)(s,r)})]}}},filler:{propagate:!1},legend:{display:!1,labels:{usePointStyle:!0}}},elements:{line:{tension:.3,borderWidth:1.5},bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:5}},locale:(0,A.Hd)(r)};return d&&(h.scales.xAxisCompare=Object.assign(Object.assign({},h.scales.x),{},{suggestedMin:s.getTime(),suggestedMax:i.getTime(),display:!1})),h}))}},{kind:"method",key:"_getStatistics",value:(a=(0,l.Z)((0,d.Z)().mark((function e(t){var a,r,n,s,i;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=t.prefs.energy_sources.filter((function(e){return"solar"===e.type}))).some((function(e){var t;return null===(t=e.config_entry_solar_forecast)||void 0===t?void 0:t.length}))){e.next=10;break}return e.prev=2,e.next=5,(0,O.jB)(this.hass);case 5:r=e.sent,e.next=10;break;case 8:e.prev=8,e.t0=e.catch(2);case 10:n=[],s=getComputedStyle(this),i=s.getPropertyValue("--energy-solar-color").trim(),n.push.apply(n,(0,c.Z)(this._processDataSet(t.stats,t.statsMetadata,a,i,s))),t.statsCompare&&(n.push({order:0,data:[]}),n.push({order:999,data:[],xAxisID:"xAxisCompare"}),n.push.apply(n,(0,c.Z)(this._processDataSet(t.statsCompare,t.statsMetadata,a,i,s,!0)))),r&&n.push.apply(n,(0,c.Z)(this._processForecast(t.statsMetadata,r,a,s.getPropertyValue("--primary-text-color"),t.start,t.end))),this._start=t.start,this._end=t.end||(0,k.Z)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare,this._chartData={datasets:n};case 21:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(e){return a.apply(this,arguments)})},{kind:"method",key:"_processDataSet",value:function(e,t,a,r,n){var s=this,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=[];return a.forEach((function(a,d){var c=n.getPropertyValue("--energy-solar-color-"+d).trim();if(0===c.length){var l=d>0?s.hass.themes.darkMode?(0,B.C)((0,z.Rw)((0,z.wK)(r)),d):(0,B.W)((0,z.Rw)((0,z.wK)(r)),d):void 0;c=l?(0,z.CO)((0,z.p3)(l)):r}var h=null,f=[];if(a.stat_energy_from in e){var p,g,y=e[a.stat_energy_from],v=(0,u.Z)(y);try{for(v.s();!(g=v.n()).done;){var _=g.value;if(null!==_.change&&void 0!==_.change&&h!==_.start){var m=new Date(_.start);f.push({x:m.getTime(),y:_.change}),h=_.start,p=_.end}}}catch(k){v.e(k)}finally{v.f()}1===f.length&&f.push({x:p,y:0})}o.push({label:s.hass.localize("ui.panel.lovelace.cards.energy.energy_solar_graph.production",{name:(0,R.Kd)(s.hass,a.stat_energy_from,t[a.stat_energy_from])}),borderColor:i?c+"7F":c,backgroundColor:i?c+"32":c+"7F",data:f,order:1,stack:"solar",xAxisID:i?"xAxisCompare":void 0})})),o}},{kind:"method",key:"_processForecast",value:function(e,t,a,r,n,s){var i=this,d=[],c=(0,x.Z)(s||new Date,n);return a.forEach((function(a){if(a.config_entry_solar_forecast){var l={};if(a.config_entry_solar_forecast.forEach((function(e){t[e]&&Object.entries(t[e].wh_hours).forEach((function(e){var t=(0,o.Z)(e,2),a=t[0],r=t[1],i=new Date(a);if(!(i<n||s&&i>s)){c>35&&i.setDate(1),c>2?i.setHours(0,0,0,0):i.setMinutes(0,0,0);var d=i.getTime();d in l?l[d]+=r:l[d]=r}}))})),l){for(var u=[],h=0,f=Object.entries(l);h<f.length;h++){var p=(0,o.Z)(f[h],2),g=p[0],y=p[1];u.push({x:Number(g),y:y/1e3})}u.length&&d.push({type:"line",label:i.hass.localize("ui.panel.lovelace.cards.energy.energy_solar_graph.forecast",{name:(0,R.Kd)(i.hass,a.stat_energy_from,e[a.stat_energy_from])}),fill:!1,stepped:!1,borderColor:r,borderDash:[7,5],pointRadius:0,data:u})}}})),d}},{kind:"get",static:!0,key:"styles",value:function(){return(0,C.iv)(i||(i=(0,h.Z)(["ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;box-sizing:border-box}"])))}}]}}),(0,F.f)(C.oi))}}]);
//# sourceMappingURL=70310-PVlx8APkRLw.js.map