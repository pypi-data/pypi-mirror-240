(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{165:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(4),a=n(7),o=n(51),u=n(3),c=n(61),l=(n(77),n(163));function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),e}function v(e,t,n){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=j(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j(e);if(t){var i=j(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return w(this,n)}}function w(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var k=[{label:Object(r.a)("Difference"),value:"difference"},{label:Object(r.a)("Maximum"),value:"maximum"},{label:Object(r.a)("Minimum"),value:"minimum"},{label:Object(r.a)("Average"),value:"average"}],I=[{label:Object(r.a)("Changes"),value:"changes"},{label:Object(r.a)("On Time"),value:"on-time"},{label:Object(r.a)("Off Time"),value:"off-time"}],P=["difference"],C={second:"%S",minute:"%H:%M",hour:"%H:00",day:"%d",weekDay:"%a",month:"%b"},_=function(e){g(n,e);var t=O(n);function n(e){var a,o=h({},e);b(this,n);var u=(a=t.call(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},o))).getFieldIndex("timeInterval");return a.addField(u,new i.d({name:"barInfo",label:Object(r.a)("Bar Information"),required:!0,choices:[]})),a.getField("timeInterval").hide(),a}return y(n,[{key:"updateFieldsVisibility",value:function(){v(j(n.prototype),"updateFieldsVisibility",this).call(this);var e=this.isBoolean()?I:k;this.getField("barInfo").setChoices(e)}}]),n}(l.b),S=function(e){g(n,e);var t=O(n);function n(){var e;return b(this,n),(e=t.call(this))._barInfo=null,e}return y(n,[{key:"configToJSON",value:function(){return u.b(v(j(n.prototype),"configToJSON",this).call(this),{barInfo:this._barInfo})}},{key:"configFromJSON",value:function(e){v(j(n.prototype),"configFromJSON",this).call(this,e),e.barInfo!==this._barInfo&&this.invalidateCache(),null!=e.barInfo&&(this._barInfo=e.barInfo)}},{key:"isSliceHistoryMode",value:function(){return!P.includes(this._barInfo)}},{key:"showHistorySlice",value:function(e,t,n){var r=this.computeGroupsTimestamps(),i=r.slice(0,-1);e=this.isBoolean()&&this.isInverted()?e.map((function(e){return(e=u.c(e)).value=!e.value,e})):e.slice();var a=this.makeBarCategories(i),o=i.map(function(t,n){for(var a=n<i.length-1?i[n+1]:1/0,o=[];e.length>0&&e[0].timestamp<t;)e.shift();for(;e.length>0&&e[0].timestamp<a;)o.push(e.shift());var u=this.computeBarValue(o,r[n],r[n+1]);return u=Math.round(1e6*u)*this.getMultiplier()/1e6}.bind(this));this.widgetCall("setValue",o),this.widgetCall({categories:a})}},{key:"showHistoryTimestamps",value:function(e,t){t=t.slice(0,-1);var n=this.makeBarCategories(t),r=t.map(function(t,n){if(null==e[n]||null==e[n+1])return 0;var r=[e[n],e[n+1]],i=this.computeBarValue(r);return i=Math.round(1e6*i)*this.getMultiplier()/1e6}.bind(this));this.widgetCall("setValue",r),this.widgetCall({categories:n})}},{key:"makeBarCategories",value:function(e){var t=this.getTimeGroups().unit,n=C[t];return e.map((function(e){return o.b(new Date(e),n)}))}},{key:"computeBarValue",value:function(e,t,n){if(0===e.length)return 0;switch(this._barInfo){case"difference":return e[e.length-1].value-e[0].value;case"maximum":return e.reduce((function(e,t){return Math.max(t.value,e)}),-1/0);case"minimum":return e.reduce((function(e,t){return Math.min(t.value,e)}),1/0);case"average":return e.reduce((function(e,t){return t.value+e}),0)/e.length;case"changes":var r=0,i=e[0].value;return e.forEach((function(e){var t=e.value;t!==i&&(r+=1),i=t})),r;case"on-time":case"off-time":var a=0,o=null,u="on-time"===this._barInfo;return Boolean(e[0].value)!==u&&(a+=e[0].timestamp-t),e.forEach((function(e){var t=e.value,n=e.timestamp;null!==t&&(Boolean(t)===u?o=n:null!=o&&(a+=n-o,o=null))})),null!=o&&(a+=n-o),a}return 0}},{key:"makeChartOptions",value:function(){var e=u.b(v(j(n.prototype),"makeChartOptions",this).call(this),{allowTickRotation:!0});return this.isBoolean()||(e.yMin=this.getMin(),e.yMax=this.getMax(),e.unitOfMeasurement=this.getUnit()),"on-time"!==this._barInfo&&"off-time"!==this._barInfo||(e.yTicksLabelCallback=function(e){var t="%H:%M:%S";return e>=864e5&&(t="%d ".concat(Object(r.a)("days"),", ").concat(t)),o.a(e,t)}),e}},{key:"makePadding",value:function(){return{top:.2,right:0,bottom:0,left:0}}}]),n}(l.a);p(S,"CHART_TYPE","bar"),p(S,"displayName",Object(r.a)("Bar Chart")),p(S,"typeName","BarChart"),p(S,"icon",new a.a({name:"widget-bar-chart",stockName:"qtoggle"})),p(S,"ConfigForm",_),c.m(S),t.default=S}}]);
//# sourceMappingURL=7.js.map