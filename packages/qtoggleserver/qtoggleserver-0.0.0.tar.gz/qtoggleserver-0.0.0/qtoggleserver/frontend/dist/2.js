(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{161:function(t,e,n){"use strict";n.d(e,"a",(function(){return y})),n.d(e,"b",(function(){return v}));var r=n(2),i=n(0),o=n(160),a=n(74),u=n(61);function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)}function m(t,e){return(m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function p(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=b(t);if(e){var i=b(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d(this,n)}}function d(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var y=function(t){f(n,t);var e=p(n);function n(){return h(this,n),e.apply(this,arguments)}return n}(a.a),v=function(t){f(a,t);var e,n,i,o=p(a);function a(){var t;return h(this,a),(t=o.call(this))._chartContainer=null,t.widgetCall=null,t}return e=a,(n=[{key:"makeContent",value:function(t,e){return this._chartContainer=Object(r.a)("<div></div>",{class:"dashboard-chart-widget-container"}),this._chartContainer.css({width:"".concat(t,"em"),height:"".concat(e,"em")}),this.makeChart(this._chartContainer),this._chartContainer}},{key:"makeChart",value:function(t){var e=t["".concat(this.constructor.CHART_TYPE,"chart")];this.widgetCall=function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e.apply(t,r)},this.widgetCall(this.makeChartOptions())}},{key:"makeChartOptions",value:function(){var t=this.getCellWidth(),e=this.getEmSize()*u.d,n=this.makePadding();return{scalingFactor:e,showTooltips:!0,extraChartOptions:{layout:{padding:{top:n.top*t,right:n.right*t,bottom:n.bottom*t,left:n.left*t}}}}}},{key:"makePadding",value:function(){return{top:0,right:0,bottom:0,left:0}}}])&&l(e.prototype,n),i&&l(e,i),a}(o.b);s(v,"CHART_TYPE","override.me"),s(v,"category",Object(i.a)("Charts")),s(v,"noProgressInteraction",!0),s(v,"vResizable",!0),s(v,"hResizable",!0),s(v,"hasFrame",!0)},163:function(t,e,n){"use strict";n.d(e,"b",(function(){return D})),n.d(e,"a",(function(){return M}));var r=n(14),i=n(0),o=n(4),a=n(22),u=n(3),c=n(11),l=n(31),s=n(47),h=n(66),f=n(71),m=n(160),p=n(161);function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function b(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function y(){return(y=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function g(t,e,n){return e&&_(t.prototype,e),n&&_(t,n),t}function O(t,e,n){return(O="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=S(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function j(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}function w(t,e){return(w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function P(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=S(t);if(e){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k(this,n)}}function k(t,e){return!e||"object"!==d(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function S(t){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function I(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var E=[{label:Object(i.a)("1 second"),value:1},{label:c.a(Object(i.a)("%(count)d seconds"),{count:5}),value:5},{label:c.a(Object(i.a)("%(count)d seconds"),{count:10}),value:10},{label:c.a(Object(i.a)("%(count)d seconds"),{count:30}),value:30},{label:Object(i.a)("1 minute"),value:60},{label:c.a(Object(i.a)("%(count)d minutes"),{count:5}),value:300},{label:c.a(Object(i.a)("%(count)d minutes"),{count:10}),value:600},{label:c.a(Object(i.a)("%(count)d minutes"),{count:15}),value:900},{label:c.a(Object(i.a)("%(count)d minutes"),{count:30}),value:1800},{label:Object(i.a)("1 hour"),value:3600},{label:c.a(Object(i.a)("%(count)d hours"),{count:4}),value:14400},{label:c.a(Object(i.a)("%(count)d hours"),{count:8}),value:28800},{label:c.a(Object(i.a)("%(count)d hours"),{count:12}),value:43200},{label:Object(i.a)("1 day"),value:86400},{label:Object(i.a)("1 week"),value:604800},{label:Object(i.a)("1 month"),value:2678400},{label:Object(i.a)("1 year"),value:31622400}],C=[{label:"".concat(Object(i.a)("1 minute")," (").concat(Object(i.a)("every second"),")"),value:{multiplier:60,unit:"second"}},{label:"".concat(c.a(Object(i.a)("%(count)d minutes"),{count:5})," (").concat(Object(i.a)("every minute"),")"),value:{multiplier:5,unit:"minute"}},{label:"".concat(c.a(Object(i.a)("%(count)d minutes"),{count:10})," (").concat(Object(i.a)("every minute"),")"),value:{multiplier:10,unit:"minute"}},{label:"".concat(c.a(Object(i.a)("%(count)d minutes"),{count:15})," (").concat(Object(i.a)("every minute"),")"),value:{multiplier:15,unit:"minute"}},{label:"".concat(c.a(Object(i.a)("%(count)d minutes"),{count:30})," (").concat(Object(i.a)("every minute"),")"),value:{multiplier:30,unit:"minute"}},{label:"".concat(Object(i.a)("1 hour")," (").concat(Object(i.a)("every minute"),")"),value:{multiplier:60,unit:"minute"}},{label:"".concat(c.a(Object(i.a)("%(count)d hours"),{count:4})," (").concat(Object(i.a)("every hour"),")"),value:{multiplier:4,unit:"hour"}},{label:"".concat(c.a(Object(i.a)("%(count)d hours"),{count:8})," (").concat(Object(i.a)("every hour"),")"),value:{multiplier:8,unit:"hour"}},{label:"".concat(c.a(Object(i.a)("%(count)d hours"),{count:12})," (").concat(Object(i.a)("every hour"),")"),value:{multiplier:12,unit:"hour"}},{label:"".concat(Object(i.a)("1 day")," (").concat(Object(i.a)("every hour"),")"),value:{multiplier:24,unit:"hour"}},{label:"".concat(Object(i.a)("1 week")," (").concat(Object(i.a)("every day"),")"),value:{multiplier:7,unit:"weekDay"}},{label:"".concat(Object(i.a)("1 month")," (").concat(Object(i.a)("every day"),")"),value:{multiplier:31,unit:"day"}},{label:"".concat(Object(i.a)("1 year")," (").concat(Object(i.a)("every month"),")"),value:{multiplier:12,unit:"month"}}],H={weekDay:"day"},T=r.default.get("qtoggle.dashboard.widgets"),D=function(t){j(n,t);var e=P(n);function n(t){var r=y({},t);return v(this,n),e.call(this,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?b(Object(n),!0).forEach((function(e){I(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({fields:[new f.a({name:"portId",label:Object(i.a)("Port"),required:!0,onChange:function(t,e){return e.updateFieldsVisibility()}}),new o.c({name:"color",filterEnabled:!0,label:Object(i.a)("Color"),required:!0}),new o.d({name:"timeInterval",label:Object(i.a)("Time Interval"),required:!0,choices:E}),new o.d({name:"timeGroups",label:Object(i.a)("Time Groups"),required:!0,choices:C}),new o.h({name:"max",label:Object(i.a)("Maximum Value"),description:Object(i.a)("Lower chart limit. Leave empty for automatic adjustment.")}),new o.h({name:"min",label:Object(i.a)("Minimum Value"),description:Object(i.a)("Higher chart limit. Leave empty for automatic adjustment.")}),new o.n({name:"unit",label:Object(i.a)("Unit"),maxLength:16}),new o.h({name:"multiplier",label:Object(i.a)("Multiplier"),description:Object(i.a)("A multiplying factor for port values."),required:!0}),new o.a({name:"inverted",label:Object(i.a)("Inverted Logic")})]},r))}return g(n,[{key:"isBoolean",value:function(){var t=this.getUnvalidatedData(),e=this.getPort(t.portId),n=!0;return e&&"number"===e.type&&(n=!1),n}},{key:"updateFieldsVisibility",value:function(){this.isBoolean()?(this.constructor.NUMBER_FIELD_NAMES.forEach((function(t){this.getField(t).hide()}),this),this.constructor.BOOLEAN_FIELD_NAMES.forEach((function(t){this.getField(t).show()}),this)):(this.constructor.BOOLEAN_FIELD_NAMES.forEach((function(t){this.getField(t).hide()}),this),this.constructor.NUMBER_FIELD_NAMES.forEach((function(t){this.getField(t).show()}),this))}},{key:"onUpdateFromWidget",value:function(){this.updateFieldsVisibility()}},{key:"fromPort",value:function(t,e){var r=O(S(n.prototype),"fromPort",this).call(this,t,e);return r.unit=t.unit,r.min=null!=t.min?t.min:null,r.max=null!=t.max?t.max:null,r}}]),n}(p.a);I(D,"BOOLEAN_FIELD_NAMES",["inverted"]),I(D,"NUMBER_FIELD_NAMES",["min","max","unit","multiplier"]);var M=function(t){j(n,t);var e=P(n);function n(){var t;return v(this,n),(t=e.call(this))._portId="",t._color=m.a,t._timeInterval=null,t._timeGroups=null,t._min=null,t._max=null,t._unit="",t._multiplier=1,t._inverted=!1,t._fetchHistoryPromise=null,t._historyDownloadManager=null,t._cachedSamples=[],t._dateAdapter=new l._adapters._date,t}return g(n,[{key:"isValid",value:function(){if(!this._portId)return!1;var t=this.getPort(this._portId);return Boolean(t&&t.enabled&&!1!==t.online)}},{key:"isBoolean",value:function(){var t=this.getPort(this._portId);return t&&"boolean"===t.type}},{key:"isSliceHistoryMode",value:function(){return!0}},{key:"isInverted",value:function(){return this._inverted}},{key:"getMin",value:function(){return this._min}},{key:"getMax",value:function(){return this._max}},{key:"getUnit",value:function(){return this._unit}},{key:"getTimeGroups",value:function(){return this._timeGroups}},{key:"getTimeInterval",value:function(){return this._timeInterval}},{key:"getFromTimestamp",value:function(){var t=new Date;if(null!=this._timeInterval)return t.getTime()-1e3*this._timeInterval;if(null!=this._timeGroups){var e=this._timeGroups,n=e.multiplier,r=e.unit;r=H[r]||r;var i=this._dateAdapter.endOf(t,r).getTime()+1;return this._dateAdapter.add(i,-n-1,r).getTime()}return t.getTime()}},{key:"getMultiplier",value:function(){return this._multiplier}},{key:"invalidateCache",value:function(){this._historyDownloadManager=null,this._cachedSamples=[]}},{key:"showCurrentValue",value:function(){var t,e,n,r,o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];o&&!this._fetchHistoryPromise&&this.setProgress();var a=this.isSliceHistoryMode();a?(e=this.getFromTimestamp(),n=(new Date).getTime(),t=this.getHistorySlice(e,n)):(r=this.computeGroupsTimestamps(),t=this.getHistoryTimestamps(r)),t.then(function(t){this._fetchHistoryPromise||this.clearProgress(),this.getHTML().parents("body").length>0&&(a?this.showHistorySlice(t,e,n):this.showHistoryTimestamps(t,r))}.bind(this)).catch(function(t){if(t instanceof h.a){var e=Object(i.a)("Please choose a smaller interval of time!");T.warn("too many requests while downloading history"),t=e}else T.errorStack("fetching history for port ".concat(this._portId," failed"),t);this.setError(t)}.bind(this))}},{key:"onPortValueChange",value:function(t,e){if(t===this._portId&&this.getPanel().isActive()&&!this._fetchHistoryPromise){if(this.isSliceHistoryMode()){if(!this._historyDownloadManager)return;var n=this.getFromTimestamp();this._historyDownloadManager.purge(null,n),this._historyDownloadManager.addSample(e,(new Date).getTime(),!0)}else for(;this._cachedSamples.length>400;)this._cachedSamples.shift();this.showCurrentValue(!1)}}},{key:"onPanelBecomeActive",value:function(){this.getPanel().isEditEnabled()||(this.invalidateCache(),this.showCurrentValue())}},{key:"configToJSON",value:function(){return{portId:this._portId,color:this._color,timeInterval:this._timeInterval,timeGroups:this._timeGroups,min:this._min,max:this._max,unit:this._unit,multiplier:this._multiplier,inverted:this._inverted}}},{key:"configFromJSON",value:function(t){t.portId!==this._portId&&this.invalidateCache(),t.timeGroups!==this._timeGroups&&this.invalidateCache(),t.portId&&(this._portId=t.portId),t.color&&(this._color=t.color),t.timeInterval&&(this._timeInterval=t.timeInterval),t.timeGroups&&(this._timeGroups=t.timeGroups),void 0!==t.min&&(this._min=t.min),void 0!==t.max&&(this._max=t.max),null!=t.unit&&(this._unit=t.unit),null!=t.multiplier&&(this._multiplier=t.multiplier),null!=t.inverted&&(this._inverted=t.inverted)}},{key:"computeGroupsTimestamps",value:function(){if(null==this._timeGroups)return[];var t=[],e=this._timeGroups,n=e.multiplier,r=e.unit;r=H[r]||r;var i=new Date,o=this._dateAdapter.endOf(i,r).getTime()+1;t.push(o);for(var a=0;a<n;a++)o=this._dateAdapter.add(o,-1,r).getTime(),t.push(o);return t.reverse(),t}},{key:"getHistorySlice",value:function(t,e){if(!this._portId)return Promise.resolve([]);var n=(this._fetchHistoryPromise||Promise.resolve()).then(function(){return this._historyDownloadManager||(this._historyDownloadManager=new h.b(this.getPort(this._portId))),this._historyDownloadManager.fetch(Math.round(t),Math.round(e),5)}.bind(this)).catch(function(t){throw this._fetchHistoryPromise=null,t}.bind(this)).then(function(t){return this._fetchHistoryPromise===n&&(this._fetchHistoryPromise=null),t}.bind(this));return this._fetchHistoryPromise=n,this._fetchHistoryPromise}},{key:"getHistoryTimestamps",value:function(t){if((t=t.slice()).sort(),!t.length)return Promise.resolve([]);var e=(this._fetchHistoryPromise||Promise.resolve()).then(function(){var e=0;this._cachedSamples.length>0&&(e=this._cachedSamples[this._cachedSamples.length-1].timestamp);var n=t.filter((function(t){return t>e}));return n.length>0?s.getPortHistory(this._portId,null,null,null,n):Promise.resolve([])}.bind(this)).catch(function(t){throw this._fetchHistoryPromise=null,t}.bind(this)).then(function(n){if(this._cachedSamples.length){var r=this._cachedSamples[this._cachedSamples.length-1];n=n.filter((function(t){return null!=t&&t.timestamp>r.timestamp}))}else n=n.filter((function(t){return null!=t}));var i=n.slice(0,1);if(n.slice(1).forEach((function(t,e){var r=n[e];t.timestamp!==r.timestamp&&i.push(t)})),n=i,this._cachedSamples=this._cachedSamples.concat(n),this._fetchHistoryPromise===e&&(this._fetchHistoryPromise=null),0===this._cachedSamples.length)return a.b(0,t.length).map((function(){return null}));for(var o=[],u=this._cachedSamples.slice(),c=t.length-1;c>=0;c--){for(var l=t[c];u.length&&u[u.length-1].timestamp>l;)u.pop();if(!u.length)break;o.push(u[u.length-1])}for(;o.length<t.length;)o.push(null);return o.reverse(),o}.bind(this));return this._fetchHistoryPromise=e,this._fetchHistoryPromise}},{key:"showHistorySlice",value:function(t,e,n){}},{key:"showHistoryTimestamps",value:function(t,e){}},{key:"makeChartOptions",value:function(){return u.b(O(S(n.prototype),"makeChartOptions",this).call(this),{colors:[this._color]})}}]),n}(p.b);I(M,"ConfigForm",D)}}]);
//# sourceMappingURL=2.js.map