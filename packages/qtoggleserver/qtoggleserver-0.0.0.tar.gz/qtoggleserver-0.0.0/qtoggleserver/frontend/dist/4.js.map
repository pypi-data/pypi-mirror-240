{"version":3,"sources":["webpack:///./js/dashboard/widgets/all-widgets/push-buttons/push-button.js","webpack:///./js/dashboard/widgets/all-widgets/push-buttons/sequence-push-button.js"],"names":["ConfigForm","args","fields","ColorComboField","name","label","gettext","filterEnabled","required","PortPickerField","onChange","value","form","_showHidePortTypeFields","CheckField","NumericField","UpDownField","unit","min","max","step","description","data","this","getUnvalidatedData","port","getPort","portId","isBoolean","type","booleanFieldNames","numberFieldNames","forEach","getField","hide","show","WidgetConfigForm","PushButton","_color","DEFAULT_COLOR","_portId","_inverted","_pressedValue","_releasedValue","_timeout","_timeoutHandle","_bezelDiv","_handleDiv","Boolean","enabled","writable","online","width","height","container","$","class","_makeBezel","css","Widgets","append","_makeHandleDiv","diameter","Math","marginTop","bezelDiv","handleDiv","background","Theme","margin","roundEm","that","pointerUp","Window","off","vibrate","handleRelease","clearTimeout","on","e","handlePress","setTimeout","preventDefault","_isBoolean","setPortValue","color","inverted","pressedValue","releasedValue","timeout","json","Widget","StockIcon","stockName","_updateSeqFields","separator","_updateRepeatFields","seqValueFields","getFields","filter","field","getName","match","RegExp","seqDelayFields","seqFields","concat","lastSeqFieldNo","length","removeField","ArrayUtils","seqLength","no","_addSeqFields","push","valueField","delayField","_getSeqFields","integer","addField","repeatForeverField","repeatCountField","repeat","repeatForever","repeatCount","setData","widget","delays","values","SequencePushButton","_values","_delays","_repeatCount","setPortSequence","slice"],"mappings":"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","file":"4.js","sourcesContent":["\nimport $ from '$qui/lib/jquery.module.js'\n\nimport {gettext}         from '$qui/base/i18n.js'\nimport {CheckField}      from '$qui/forms/common-fields/common-fields.js'\nimport {ColorComboField} from '$qui/forms/common-fields/common-fields.js'\nimport {NumericField}    from '$qui/forms/common-fields/common-fields.js'\nimport {UpDownField}     from '$qui/forms/common-fields/common-fields.js'\nimport StockIcon         from '$qui/icons/stock-icon.js'\nimport * as Theme        from '$qui/theme.js'\nimport * as Window       from '$qui/window.js'\n\nimport PortPickerField  from '$app/dashboard/widgets/port-picker-field.js'\nimport * as Widgets     from '$app/dashboard/widgets/widgets.js'\nimport Widget           from '$app/dashboard/widgets/widget.js'\nimport {DEFAULT_COLOR}  from '$app/dashboard/widgets/widget.js'\nimport WidgetConfigForm from '$app/dashboard/widgets/widget-config-form.js'\n\n\nclass ConfigForm extends WidgetConfigForm {\n\n    constructor({...args}) {\n        super({\n            fields: [\n                new ColorComboField({\n                    name: 'color',\n                    label: gettext('Color'),\n                    filterEnabled: true,\n                    required: true\n                }),\n                new PortPickerField({\n                    name: 'portId',\n                    label: gettext('Port'),\n                    required: true,\n                    onChange: (value, form) => form._showHidePortTypeFields()\n                }),\n                new CheckField({\n                    name: 'inverted',\n                    label: gettext('Inverted Logic')\n                }),\n                new NumericField({\n                    name: 'pressedValue',\n                    label: gettext('Pressed Value'),\n                    required: true\n                }),\n                new NumericField({\n                    name: 'releasedValue',\n                    label: gettext('Released Value'),\n                    required: true\n                }),\n                new UpDownField({\n                    name: 'timeout',\n                    label: gettext('Release Timeout'),\n                    unit: 'ms',\n                    min: 0,\n                    max: 10000,\n                    step: 100,\n                    description: gettext('Sets the time after which the button is automatically released. ' +\n                                         'Value 0 disables automatic release.')\n                })\n            ],\n            ...args\n        })\n    }\n\n    _showHidePortTypeFields() {\n        let data = this.getUnvalidatedData()\n        let port = this.getPort(data.portId)\n        let isBoolean = true\n        if (port && port.type === 'number') {\n            isBoolean = false\n        }\n\n        let booleanFieldNames = ['inverted']\n        let numberFieldNames = ['pressedValue', 'releasedValue']\n\n        if (isBoolean) {\n            numberFieldNames.forEach(function (name) {\n                this.getField(name).hide()\n            }, this)\n            booleanFieldNames.forEach(function (name) {\n                this.getField(name).show()\n            }, this)\n        }\n        else {\n            booleanFieldNames.forEach(function (name) {\n                this.getField(name).hide()\n            }, this)\n            numberFieldNames.forEach(function (name) {\n                this.getField(name).show()\n            }, this)\n        }\n    }\n\n    onUpdateFromWidget() {\n        this._showHidePortTypeFields()\n    }\n\n}\n\n\n/**\n * @alias qtoggle.dashboard.widgets.pushbuttons.PushButton\n * @extends qtoggle.dashboard.widgets.Widget\n */\nclass PushButton extends Widget {\n\n    static category = gettext('Push Buttons')\n    static displayName = gettext('Push Button')\n    static typeName = 'PushButton'\n    static icon = new StockIcon({name: 'widget-push-button', stockName: 'qtoggle'})\n    static ConfigForm = ConfigForm\n    static vResizable = true\n    static hResizable = true\n\n\n    /**\n     * @constructs\n     */\n    constructor() {\n        super()\n\n        this._color = DEFAULT_COLOR\n        this._portId = ''\n        this._inverted = false\n        this._pressedValue = 1\n        this._releasedValue = 0\n        this._timeout = 1000\n        this._timeoutHandle = null\n\n        this._bezelDiv = null\n        this._handleDiv = null\n    }\n\n    isValid() {\n        if (!this._portId) {\n            return false\n        }\n\n        let port = this.getPort(this._portId)\n\n        return Boolean(port && port.enabled && port.writable && port.online !== false)\n    }\n\n    makeContent(width, height) {\n        let container = $('<div></div>', {class: 'dashboard-push-button-container'})\n\n        this._bezelDiv = this._makeBezel(width, height)\n        container.css('borderWidth', `${Widgets.CELL_PADDING}em`)\n        container.append(this._bezelDiv)\n\n        this._handleDiv = this._makeHandleDiv()\n        this._bezelDiv.append(this._handleDiv)\n\n        return container\n    }\n\n    _makeBezel(width, height) {\n        let diameter = Math.min(width, height) - 2 * Widgets.CELL_PADDING\n        let marginTop = (height > width) ? (height - width) / 2 : 0\n        let bezelDiv = $('<div></div>', {class: 'dashboard-push-button-bezel'})\n        bezelDiv.css({\n            'width': `${diameter}em`,\n            'height': `${diameter}em`,\n            'margin-top': `${marginTop}em`\n        })\n\n        return bezelDiv\n    }\n\n    _makeHandleDiv() {\n        let handleDiv = $('<div></div>', {class: 'qui-base-button dashboard-push-button-handle'})\n        handleDiv.css({\n            background: Theme.getColor(this._color),\n            margin: `${this.roundEm(Widgets.BEZEL_WIDTH)}em`\n        })\n\n        let that = this\n\n        function pointerUp() {\n            Window.$body.off('pointerup pointercancel pointerleave', pointerUp)\n\n            that.vibrate()\n            that.handleRelease()\n\n            if (that._timeoutHandle) {\n                clearTimeout(that._timeoutHandle)\n                that._timeoutHandle = null\n            }\n        }\n\n        handleDiv.on('pointerdown', function (e) {\n            Window.$body.on('pointerup pointercancel pointerleave', pointerUp)\n\n            that.vibrate()\n            that.handlePress()\n\n            if (that._timeout) {\n                that._timeoutHandle = setTimeout(function () {\n                    that._timeoutHandle = null\n                    pointerUp()\n                }, that._timeout)\n            }\n\n            e.preventDefault()\n        })\n\n        return handleDiv\n    }\n\n    _isBoolean() {\n        let isBoolean = true\n        let port = this.getPort(this._portId)\n        if (port && port.type === 'number') {\n            isBoolean = false\n        }\n\n        return isBoolean\n    }\n\n    handlePress() {\n        if (this._isBoolean()) {\n            this.setPortValue(this._portId, !this._inverted)\n        }\n        else {\n            this.setPortValue(this._portId, this._pressedValue)\n        }\n    }\n\n    handleRelease() {\n        if (this._isBoolean()) {\n            this.setPortValue(this._portId, this._inverted)\n        }\n        else {\n            this.setPortValue(this._portId, this._releasedValue)\n        }\n    }\n\n    configToJSON() {\n        return {\n            color: this._color,\n            portId: this._portId,\n            inverted: this._inverted,\n            pressedValue: this._pressedValue,\n            releasedValue: this._releasedValue,\n            timeout: this._timeout\n        }\n    }\n\n    configFromJSON(json) {\n        if (json.color) {\n            this._color = json.color\n        }\n        if (json.portId) {\n            this._portId = json.portId\n        }\n        if (json.inverted != null) {\n            this._inverted = json.inverted\n        }\n        if (json.pressedValue != null) {\n            this._pressedValue = json.pressedValue\n        }\n        if (json.releasedValue != null) {\n            this._releasedValue = json.releasedValue\n        }\n        if (json.timeout != null) {\n            this._timeout = json.timeout\n        }\n    }\n\n}\n\nWidgets.register(PushButton)\n\n\nexport default PushButton\n","\nimport {gettext}         from '$qui/base/i18n.js'\nimport {CheckField}      from '$qui/forms/common-fields/common-fields.js'\nimport {ColorComboField} from '$qui/forms/common-fields/common-fields.js'\nimport {NumericField}    from '$qui/forms/common-fields/common-fields.js'\nimport {UpDownField}     from '$qui/forms/common-fields/common-fields.js'\nimport StockIcon         from '$qui/icons/stock-icon.js'\nimport * as ArrayUtils   from '$qui/utils/array.js'\n\nimport PortPickerField  from '$app/dashboard/widgets/port-picker-field.js'\nimport * as Widgets     from '$app/dashboard/widgets/widgets.js'\nimport WidgetConfigForm from '$app/dashboard/widgets/widget-config-form.js'\n\nimport PushButton from './push-button.js'\n\n\nclass ConfigForm extends WidgetConfigForm {\n\n    constructor({...args}) {\n        super({\n            fields: [\n                new ColorComboField({\n                    name: 'color',\n                    label: gettext('Color'),\n                    filterEnabled: true,\n                    required: true\n                }),\n                new PortPickerField({\n                    name: 'portId',\n                    label: gettext('Port'),\n                    required: true,\n                    onChange: (value, form) => form._updateSeqFields()\n                }),\n                new CheckField({\n                    name: 'repeat',\n                    label: gettext('Repeat'),\n                    separator: true,\n                    onChange: (value, form) => form._updateRepeatFields()\n                }),\n                new CheckField({\n                    name: 'repeatForever',\n                    label: gettext('Repeat Forever'),\n                    onChange: (value, form) => form._updateRepeatFields()\n                }),\n                new NumericField({\n                    name: 'repeatCount',\n                    label: gettext('Repeat Count'),\n                    unit: gettext('times'),\n                    required: true,\n                    min: 2,\n                    max: 65535\n                }),\n                new UpDownField({\n                    name: 'seqLength',\n                    label: gettext('Sequence Length'),\n                    separator: true,\n                    min: 0,\n                    max: 100,\n                    onChange: (value, form) => form._updateSeqFields()\n                })\n            ],\n            ...args\n        })\n    }\n\n    onUpdateFromWidget() {\n        this._updateSeqFields()\n        this._updateRepeatFields()\n    }\n\n    _updateSeqFields() {\n        let seqValueFields = this.getFields().filter(field => field.getName().match(new RegExp('seqValue\\\\d+')))\n        let seqDelayFields = this.getFields().filter(field => field.getName().match(new RegExp('seqDelay\\\\d+')))\n        let seqFields = seqDelayFields.concat(seqValueFields)\n\n        let lastSeqFieldNo = seqDelayFields.length - 1\n\n        let data = this.getUnvalidatedData()\n        let port = this.getPort(data.portId)\n\n        let isBoolean = !(port && port.type === 'number')\n        let field = this.getField('seqValue0')\n        let hasBooleanFields = field ? field instanceof CheckField : false\n\n        if (isBoolean !== hasBooleanFields) {\n            /* Value type differs, we must recreate all fields */\n            seqFields.forEach(function (field) {\n                this.removeField(field)\n            }, this)\n\n            lastSeqFieldNo = -1\n        }\n\n        /* Add new needed fields */\n        ArrayUtils.range(lastSeqFieldNo + 1, data.seqLength).forEach(function (no) {\n\n            let fields = this._addSeqFields(no, port)\n\n            seqFields.push(fields.valueField)\n            seqFields.push(fields.delayField)\n\n        }, this)\n\n        /* Show all used fields */\n        ArrayUtils.range(0, data.seqLength).forEach(function (no) {\n\n            let fields = this._getSeqFields(no)\n\n            fields.valueField.show()\n            fields.delayField.show()\n\n        }, this)\n\n        /* Hide all unused fields */\n        ArrayUtils.range(data.seqLength, lastSeqFieldNo + 1).forEach(function (no) {\n\n            let fields = this._getSeqFields(no)\n\n            fields.valueField.hide()\n            fields.delayField.hide()\n\n        }, this)\n    }\n\n    _addSeqFields(no, port) {\n        let isBoolean = !(port && port.type === 'number')\n\n        let min = null\n        let max = null\n        let integer = false\n        let step = null\n        if (port) {\n            min = port.min\n            max = port.max\n            integer = port.integer\n            step = port.step\n        }\n\n        let valueField\n        if (isBoolean) {\n            valueField = new CheckField({\n                name: `seqValue${no}`,\n                label: `${gettext('Value')} ${no + 1}`,\n                required: false,\n                separator: true\n            })\n        }\n        else {\n            valueField = new NumericField({\n                name: `seqValue${no}`,\n                label: `${gettext('Value')} ${no + 1}`,\n                min: min, // TODO do these options work?\n                max: max,\n                integer: integer,\n                step: step,\n                required: true,\n                separator: true\n            })\n        }\n\n        this.addField(-1, valueField)\n\n        let delayField = new NumericField({\n            name: `seqDelay${no}`,\n            label: `${gettext('Delay')} ${no + 1}`,\n            required: true,\n            unit: 'ms',\n            min: 1, // TODO do these options work?\n            max: 60000\n        })\n\n        this.addField(-1, delayField)\n\n        return {\n            valueField: valueField,\n            delayField: delayField\n        }\n    }\n\n    _getSeqFields(no) {\n        let valueField = this.getField(`seqValue${no}`)\n        let delayField = this.getField(`seqDelay${no}`)\n\n        return {\n            valueField: valueField,\n            delayField: delayField\n        }\n    }\n\n    _updateRepeatFields() {\n        let data = this.getUnvalidatedData()\n        let repeatForeverField = this.getField('repeatForever')\n        let repeatCountField = this.getField('repeatCount')\n\n        if (data.repeat) {\n            repeatForeverField.show()\n            if (data.repeatForever) {\n                repeatCountField.hide()\n            }\n            else {\n                repeatCountField.show()\n                if (data.repeatCount < 2) {\n                    data.repeatCount = 2\n                    this.setData({repeatCount: 2})\n                }\n            }\n        }\n        else {\n            repeatForeverField.hide()\n            repeatCountField.hide()\n        }\n    }\n\n    fromWidget(widget) {\n        let data = super.fromWidget(widget)\n\n        data.seqLength = data.delays.length\n        ArrayUtils.range(0, data.seqLength).forEach(function (no) {\n            data[`seqValue${no}`] = data.values[no]\n            data[`seqDelay${no}`] = data.delays[no]\n        })\n\n        if (data.repeatCount >= 2) {\n            data.repeat = true\n            data.repeatForever = false\n        }\n        else if (data.repeatCount === 1) {\n            data.repeat = false\n            data.repeatForever = false\n        }\n        else { /* Assuming 0 */\n            data.repeat = true\n            data.repeatForever = true\n        }\n\n        return data\n    }\n\n    toWidget(data, widget) {\n        data.values = []\n        data.delays = []\n\n        ArrayUtils.range(0, data.seqLength).forEach(function (no) {\n            data.values[no] = data[`seqValue${no}`]\n            data.delays[no] = data[`seqDelay${no}`]\n        })\n\n        if (data.repeat) {\n            if (data.repeatForever) {\n                data.repeatCount = 0\n            }\n        }\n        else {\n            data.repeatCount = 1\n        }\n\n        super.toWidget(data, widget)\n    }\n\n}\n\n\n/**\n * @alias qtoggle.dashboard.widgets.pushbuttons.SequencePushButton\n * @extends qtoggle.dashboard.widgets.Widget\n */\nclass SequencePushButton extends PushButton {\n\n    static category = gettext('Push Buttons')\n    static displayName = gettext('Sequence Push Button')\n    static typeName = 'SequencePushButton'\n    static icon = new StockIcon({name: 'widget-push-button', stockName: 'qtoggle'})\n    static ConfigForm = ConfigForm\n    static hResizable = true\n    static vResizable = true\n\n\n    /**\n     * @constructs\n     */\n    constructor() {\n        super()\n\n        this._values = []\n        this._delays = []\n        this._repeatCount = 1\n    }\n\n    handlePress() {\n        this.setPortSequence(this._portId, this._values, this._delays, this._repeatCount)\n    }\n\n    handleRelease() {\n    }\n\n    configToJSON() {\n        return {\n            color: this._color,\n            portId: this._portId,\n            values: this._values.slice(),\n            delays: this._delays.slice(),\n            repeatCount: this._repeatCount\n        }\n    }\n\n    configFromJSON(json) {\n        if (json.color) {\n            this._color = json.color\n        }\n        if (json.portId) {\n            this._portId = json.portId\n        }\n        if (json.values != null) {\n            this._values = json.values.slice()\n        }\n        if (json.delays != null) {\n            this._delays = json.delays.slice()\n        }\n        if (json.repeatCount != null) {\n            this._repeatCount = json.repeatCount\n        }\n    }\n\n}\n\nWidgets.register(SequencePushButton)\n\n\nexport default SequencePushButton\n"],"sourceRoot":""}