{"version":3,"file":"5451e3df.js","mappings":";;;;;;AAsBA;;;;AAKA;;ACGA;;AAEA;AACA;AACA;AACA;AACA;AAGA;AACA;AAGA;;AAGA;;AAYA;AACA;AACA;;AAIA;AAOA;AACA;AACA;;AAyCA;;AAPA;AACA;;;AAMA;;;;;AA2BA;;ACjFA;;AAGA;;;AAKA;AAGA;AAEA;AAGA;;;;;AAOA;AACA;AACA;AAWA;;;;AAIA;;;AAMA;;AAEA;;AAEA;;;AA3DA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+IA","sources":["webpack://home-assistant-frontend/./src/components/ha-fab.ts","webpack://home-assistant-frontend/./src/panels/lovelace/editor/card-editor/hui-entity-picker-table.ts","webpack://home-assistant-frontend/./src/panels/lovelace/editor/unused-entities/hui-unused-entities.ts"],"sourcesContent":["import { FabBase } from \"@material/mwc-fab/mwc-fab-base\";\nimport { styles } from \"@material/mwc-fab/mwc-fab.css\";\nimport { customElement } from \"lit/decorators\";\nimport { css } from \"lit\";\n\n@customElement(\"ha-fab\")\nexport class HaFab extends FabBase {\n  protected firstUpdated(changedProperties) {\n    super.firstUpdated(changedProperties);\n    this.style.setProperty(\"--mdc-theme-secondary\", \"var(--primary-color)\");\n  }\n\n  static override styles = [\n    styles,\n    css`\n      :host .mdc-fab--extended .mdc-fab__icon {\n        margin-inline-start: -8px;\n        margin-inline-end: 12px;\n        direction: var(--direction);\n      }\n    `,\n    // safari workaround - must be explicit\n    document.dir === \"rtl\"\n      ? css`\n          :host .mdc-fab--extended .mdc-fab__icon {\n            direction: rtl;\n          }\n        `\n      : css``,\n  ];\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-fab\": HaFab;\n  }\n}\n","import { css, CSSResultGroup, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport type { HASSDomEvent } from \"../../../../common/dom/fire_event\";\nimport { fireEvent } from \"../../../../common/dom/fire_event\";\nimport { computeRTLDirection } from \"../../../../common/util/compute_rtl\";\nimport \"../../../../components/data-table/ha-data-table\";\nimport type {\n  DataTableColumnContainer,\n  DataTableRowData,\n  SelectionChangedEvent,\n} from \"../../../../components/data-table/ha-data-table\";\nimport \"../../../../components/entity/state-badge\";\nimport \"../../../../components/ha-relative-time\";\nimport type { HomeAssistant } from \"../../../../types\";\n\n@customElement(\"hui-entity-picker-table\")\nexport class HuiEntityPickerTable extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ type: Boolean }) public narrow?: boolean;\n\n  @property({ type: Boolean, attribute: \"no-label-float\" })\n  public noLabelFloat? = false;\n\n  @property({ type: Array }) public entities!: DataTableRowData[];\n\n  protected render(): TemplateResult {\n    return html`\n      <ha-data-table\n        .hass=${this.hass}\n        selectable\n        .id=${\"entity_id\"}\n        .columns=${this._columns(this.narrow!)}\n        .data=${this.entities}\n        .dir=${computeRTLDirection(this.hass)}\n        .searchLabel=${this.hass.localize(\n          \"ui.panel.lovelace.unused_entities.search\"\n        )}\n        .noLabelFloat=${this.noLabelFloat}\n        .noDataText=${this.hass.localize(\n          \"ui.panel.lovelace.unused_entities.no_data\"\n        )}\n        @selection-changed=${this._handleSelectionChanged}\n      ></ha-data-table>\n    `;\n  }\n\n  private _columns = memoizeOne((narrow: boolean) => {\n    const columns: DataTableColumnContainer = {\n      icon: {\n        title: \"\",\n        label: this.hass!.localize(\n          \"ui.panel.lovelace.unused_entities.state_icon\"\n        ),\n        type: \"icon\",\n        template: (_icon, entity: any) => html`\n          <state-badge\n            @click=${this._handleEntityClicked}\n            .hass=${this.hass!}\n            .stateObj=${entity.stateObj}\n          ></state-badge>\n        `,\n      },\n      name: {\n        title: this.hass!.localize(\"ui.panel.lovelace.unused_entities.entity\"),\n        sortable: true,\n        filterable: true,\n        grows: true,\n        direction: \"asc\",\n        template: (name, entity: any) => html`\n          <div @click=${this._handleEntityClicked} style=\"cursor: pointer;\">\n            ${name}\n            ${narrow\n              ? html` <div class=\"secondary\">${entity.entity_id}</div> `\n              : \"\"}\n          </div>\n        `,\n      },\n    };\n\n    columns.entity_id = {\n      title: this.hass!.localize(\"ui.panel.lovelace.unused_entities.entity_id\"),\n      sortable: true,\n      filterable: true,\n      width: \"30%\",\n      hidden: narrow,\n    };\n\n    columns.domain = {\n      title: this.hass!.localize(\"ui.panel.lovelace.unused_entities.domain\"),\n      sortable: true,\n      filterable: true,\n      width: \"15%\",\n      hidden: narrow,\n    };\n\n    columns.last_changed = {\n      title: this.hass!.localize(\n        \"ui.panel.lovelace.unused_entities.last_changed\"\n      ),\n      type: \"numeric\",\n      sortable: true,\n      width: \"15%\",\n      hidden: narrow,\n      template: (lastChanged: string) => html`\n        <ha-relative-time\n          .hass=${this.hass!}\n          .datetime=${lastChanged}\n          capitalize\n        ></ha-relative-time>\n      `,\n    };\n\n    return columns;\n  });\n\n  private _handleSelectionChanged(\n    ev: HASSDomEvent<SelectionChangedEvent>\n  ): void {\n    const selectedEntities = ev.detail.value;\n\n    fireEvent(this, \"selected-changed\", { selectedEntities });\n  }\n\n  private _handleEntityClicked(ev: Event) {\n    const entityId = (\n      (ev.target as HTMLElement).closest(\".mdc-data-table__row\") as any\n    ).rowId;\n    fireEvent(this, \"hass-more-info\", {\n      entityId,\n    });\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      ha-data-table {\n        --data-table-border-width: 0;\n        height: 100%;\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"hui-entity-picker-table\": HuiEntityPickerTable;\n  }\n}\n","import { mdiPlus } from \"@mdi/js\";\nimport {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  PropertyValues,\n  TemplateResult,\n} from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { classMap } from \"lit/directives/class-map\";\nimport { computeDomain } from \"../../../../common/entity/compute_domain\";\nimport { computeStateName } from \"../../../../common/entity/compute_state_name\";\nimport { computeRTL } from \"../../../../common/util/compute_rtl\";\nimport type { DataTableRowData } from \"../../../../components/data-table/ha-data-table\";\nimport \"../../../../components/ha-fab\";\nimport \"../../../../components/ha-svg-icon\";\nimport type { LovelaceConfig } from \"../../../../data/lovelace\";\nimport type { HomeAssistant } from \"../../../../types\";\nimport { computeUnusedEntities } from \"../../common/compute-unused-entities\";\nimport type { Lovelace } from \"../../types\";\nimport \"../card-editor/hui-entity-picker-table\";\nimport { showSuggestCardDialog } from \"../card-editor/show-suggest-card-dialog\";\nimport { showSelectViewDialog } from \"../select-view/show-select-view-dialog\";\n\n@customElement(\"hui-unused-entities\")\nexport class HuiUnusedEntities extends LitElement {\n  @property({ attribute: false }) public lovelace!: Lovelace;\n\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ type: Boolean }) public narrow?: boolean;\n\n  @state() private _unusedEntities: string[] = [];\n\n  @state() private _selectedEntities: string[] = [];\n\n  private get _config(): LovelaceConfig {\n    return this.lovelace.config;\n  }\n\n  protected updated(changedProperties: PropertyValues): void {\n    super.updated(changedProperties);\n\n    if (changedProperties.has(\"lovelace\")) {\n      this._getUnusedEntities();\n    }\n  }\n\n  protected render(): TemplateResult {\n    if (!this.hass || !this.lovelace) {\n      return html``;\n    }\n\n    if (this.lovelace.mode === \"storage\" && this.lovelace.editMode === false) {\n      return html``;\n    }\n\n    return html`\n      <div class=\"container\">\n        ${!this.narrow\n          ? html`\n              <ha-card\n                header=${this.hass.localize(\n                  \"ui.panel.lovelace.unused_entities.title\"\n                )}\n              >\n                <div class=\"card-content\">\n                  ${this.hass.localize(\n                    \"ui.panel.lovelace.unused_entities.available_entities\"\n                  )}\n                  ${this.lovelace.mode === \"storage\"\n                    ? html`\n                        <br />${this.hass.localize(\n                          \"ui.panel.lovelace.unused_entities.select_to_add\"\n                        )}\n                      `\n                    : \"\"}\n                </div>\n              </ha-card>\n            `\n          : \"\"}\n        <hui-entity-picker-table\n          .hass=${this.hass}\n          .narrow=${this.narrow}\n          .entities=${this._unusedEntities.map((entity) => {\n            const stateObj = this.hass!.states[entity];\n            return {\n              icon: \"\",\n              entity_id: entity,\n              stateObj,\n              name: stateObj ? computeStateName(stateObj) : \"Unavailable\",\n              domain: computeDomain(entity),\n              last_changed: stateObj?.last_changed,\n            };\n          }) as DataTableRowData[]}\n          @selected-changed=${this._handleSelectedChanged}\n        ></hui-entity-picker-table>\n      </div>\n      <div\n        class=\"fab ${classMap({\n          rtl: computeRTL(this.hass),\n          selected: this._selectedEntities.length,\n        })}\"\n      >\n        <ha-fab\n          .label=${this.hass.localize(\"ui.panel.lovelace.editor.edit_card.add\")}\n          extended\n          @click=${this._addToLovelaceView}\n        >\n          <ha-svg-icon slot=\"icon\" .path=${mdiPlus}></ha-svg-icon>\n        </ha-fab>\n      </div>\n    `;\n  }\n\n  private _getUnusedEntities(): void {\n    if (!this.hass || !this.lovelace) {\n      return;\n    }\n    this._selectedEntities = [];\n    const unusedEntities = computeUnusedEntities(this.hass, this._config!);\n    this._unusedEntities = [...unusedEntities].sort();\n  }\n\n  private _handleSelectedChanged(ev: CustomEvent): void {\n    this._selectedEntities = ev.detail.selectedEntities;\n  }\n\n  private _addToLovelaceView(): void {\n    if (this.lovelace.config.views.length === 1) {\n      showSuggestCardDialog(this, {\n        lovelaceConfig: this.lovelace.config!,\n        saveConfig: this.lovelace.saveConfig,\n        path: [0],\n        entities: this._selectedEntities,\n      });\n      return;\n    }\n    showSelectViewDialog(this, {\n      lovelaceConfig: this.lovelace.config,\n      allowDashboardChange: false,\n      viewSelectedCallback: (_urlPath, _selectedDashConfig, viewIndex) => {\n        showSuggestCardDialog(this, {\n          lovelaceConfig: this.lovelace.config!,\n          saveConfig: this.lovelace.saveConfig,\n          path: [viewIndex],\n          entities: this._selectedEntities,\n        });\n      },\n    });\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      :host {\n        background: var(--lovelace-background);\n        overflow: hidden;\n      }\n      .container {\n        display: flex;\n        flex-direction: column;\n        height: 100%;\n      }\n      ha-card {\n        --ha-card-box-shadow: none;\n        --ha-card-border-radius: 0;\n      }\n      hui-entity-picker-table {\n        flex-grow: 1;\n      }\n      .fab {\n        position: sticky;\n        float: right;\n        right: calc(16px + env(safe-area-inset-right));\n        bottom: calc(16px + env(safe-area-inset-bottom));\n        z-index: 1;\n      }\n      .fab.rtl {\n        right: initial;\n        left: 0;\n        bottom: 0;\n        padding-right: 16px;\n        padding-left: calc(16px + env(safe-area-inset-left));\n      }\n      ha-fab {\n        position: relative;\n        bottom: calc(-80px - env(safe-area-inset-bottom));\n        transition: bottom 0.3s;\n      }\n      .fab.selected ha-fab {\n        bottom: 0;\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"hui-unused-entities\": HuiUnusedEntities;\n  }\n}\n"],"names":[],"sourceRoot":""}