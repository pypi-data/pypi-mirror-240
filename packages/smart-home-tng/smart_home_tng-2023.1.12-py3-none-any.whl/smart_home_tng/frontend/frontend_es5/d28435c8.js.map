{"version":3,"file":"d28435c8.js","mappings":";;AAyDA;;;;AAQA;;AAIA;AACA;AACA;;;;;AAKA;;;;;AAOA;;AAIA;AACA;;;;;;;;AAUA;AACA;;AAEA;AACA;;;;;;;AAOA;;;AAKA;AACA;AACA;;;;;AAKA;;;AAKA;AACA;AACA;;;AAGA;;;;;;;AASA;;;;AAMA;;AAIA;;;;;;AAQA;AACA;AACA;;;;AAIA;;AAIA;;;;;;AAQA;AACA;AACA;;;;;;;;AAQA;;;;;AAOA;;;;;;AAQA;;;AAKA;AACA;AACA;;;;;;AAMA;AACA;;;AAMA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6LA","sources":["webpack://home-assistant-frontend/./src/onboarding/onboarding-core-config.ts"],"sourcesContent":["import \"@material/mwc-button/mwc-button\";\nimport \"@polymer/paper-input/paper-input\";\nimport type { PaperInputElement } from \"@polymer/paper-input/paper-input\";\nimport { css, CSSResultGroup, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport type { LocalizeFunc } from \"../common/translations/localize\";\nimport { createCurrencyListEl } from \"../components/currency-datalist\";\nimport \"../components/map/ha-locations-editor\";\nimport type {\n  HaLocationsEditor,\n  MarkerLocation,\n} from \"../components/map/ha-locations-editor\";\nimport { createTimezoneListEl } from \"../components/timezone-datalist\";\nimport {\n  ConfigUpdateValues,\n  detectCoreConfig,\n  saveCoreConfig,\n} from \"../data/core\";\nimport { SYMBOL_TO_ISO } from \"../data/currency\";\nimport { onboardCoreConfigStep } from \"../data/onboarding\";\nimport type { PolymerChangedEvent } from \"../polymer-types\";\nimport type { HomeAssistant } from \"../types\";\nimport \"../components/ha-radio\";\nimport \"../components/ha-formfield\";\nimport type { HaRadio } from \"../components/ha-radio\";\n\nconst amsterdam: [number, number] = [52.3731339, 4.8903147];\nconst mql = matchMedia(\"(prefers-color-scheme: dark)\");\nconst locationMarkerId = \"location\";\n\n@customElement(\"onboarding-core-config\")\nclass OnboardingCoreConfig extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property() public onboardingLocalize!: LocalizeFunc;\n\n  @state() private _working = false;\n\n  @state() private _name?: ConfigUpdateValues[\"location_name\"];\n\n  @state() private _location?: [number, number];\n\n  @state() private _elevation?: string;\n\n  @state() private _unitSystem?: ConfigUpdateValues[\"unit_system\"];\n\n  @state() private _currency?: ConfigUpdateValues[\"currency\"];\n\n  @state() private _timeZone?: string;\n\n  @query(\"ha-locations-editor\", true) private map!: HaLocationsEditor;\n\n  protected render(): TemplateResult {\n    return html`\n      <p>\n        ${this.onboardingLocalize(\n          \"ui.panel.page-onboarding.core-config.intro\",\n          \"name\",\n          this.hass.user!.name\n        )}\n      </p>\n\n      <paper-input\n        .label=${this.onboardingLocalize(\n          \"ui.panel.page-onboarding.core-config.location_name\"\n        )}\n        name=\"name\"\n        .disabled=${this._working}\n        .value=${this._nameValue}\n        @value-changed=${this._handleChange}\n      ></paper-input>\n\n      <div class=\"middle-text\">\n        <p>\n          ${this.onboardingLocalize(\n            \"ui.panel.page-onboarding.core-config.intro_location\"\n          )}\n        </p>\n\n        <div class=\"row\">\n          <div>\n            ${this.onboardingLocalize(\n              \"ui.panel.page-onboarding.core-config.intro_location_detect\"\n            )}\n          </div>\n          <mwc-button @click=${this._detect}>\n            ${this.onboardingLocalize(\n              \"ui.panel.page-onboarding.core-config.button_detect\"\n            )}\n          </mwc-button>\n        </div>\n      </div>\n\n      <div class=\"row\">\n        <ha-locations-editor\n          class=\"flex\"\n          .hass=${this.hass}\n          .locations=${this._markerLocation(this._locationValue)}\n          zoom=\"14\"\n          .darkMode=${mql.matches}\n          @location-updated=${this._locationChanged}\n        ></ha-locations-editor>\n      </div>\n\n      <div class=\"row\">\n        <paper-input\n          class=\"flex\"\n          .label=${this.hass.localize(\n            \"ui.panel.config.core.section.core.core_config.time_zone\"\n          )}\n          name=\"timeZone\"\n          list=\"timezones\"\n          .disabled=${this._working}\n          .value=${this._timeZoneValue}\n          @value-changed=${this._handleChange}\n        ></paper-input>\n\n        <paper-input\n          class=\"flex\"\n          .label=${this.hass.localize(\n            \"ui.panel.config.core.section.core.core_config.elevation\"\n          )}\n          name=\"elevation\"\n          type=\"number\"\n          .disabled=${this._working}\n          .value=${this._elevationValue}\n          @value-changed=${this._handleChange}\n        >\n          <span slot=\"suffix\">\n            ${this.hass.localize(\n              \"ui.panel.config.core.section.core.core_config.elevation_meters\"\n            )}\n          </span>\n        </paper-input>\n      </div>\n\n      <div class=\"row\">\n        <div class=\"flex\">\n          ${this.hass.localize(\n            \"ui.panel.config.core.section.core.core_config.unit_system\"\n          )}\n        </div>\n        <div class=\"radio-group\">\n          <ha-formfield\n            .label=${html`${this.hass.localize(\n                \"ui.panel.config.core.section.core.core_config.unit_system_metric\"\n              )}\n              <div class=\"secondary\">\n                ${this.hass.localize(\n                  \"ui.panel.config.core.section.core.core_config.metric_example\"\n                )}\n              </div>`}\n          >\n            <ha-radio\n              name=\"unit_system\"\n              value=\"metric\"\n              .checked=${this._unitSystemValue === \"metric\"}\n              @change=${this._unitSystemChanged}\n              .disabled=${this._working}\n            ></ha-radio>\n          </ha-formfield>\n          <ha-formfield\n            .label=${html`${this.hass.localize(\n                \"ui.panel.config.core.section.core.core_config.unit_system_imperial\"\n              )}\n              <div class=\"secondary\">\n                ${this.hass.localize(\n                  \"ui.panel.config.core.section.core.core_config.imperial_example\"\n                )}\n              </div>`}\n          >\n            <ha-radio\n              name=\"unit_system\"\n              value=\"imperial\"\n              .checked=${this._unitSystemValue === \"imperial\"}\n              @change=${this._unitSystemChanged}\n              .disabled=${this._working}\n            ></ha-radio>\n          </ha-formfield>\n        </div>\n      </div>\n\n      <div class=\"row\">\n            <div class=\"flex\">\n              ${this.hass.localize(\n                \"ui.panel.config.core.section.core.core_config.currency\"\n              )}<br />\n              <a\n                href=\"https://en.wikipedia.org/wiki/ISO_4217#Active_codes\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                >${this.hass.localize(\n                  \"ui.panel.config.core.section.core.core_config.find_currency_value\"\n                )}</a\n              >\n            </div>\n\n            <paper-input\n              class=\"flex\"\n              .label=${this.hass.localize(\n                \"ui.panel.config.core.section.core.core_config.currency\"\n              )}\n              name=\"currency\"\n              list=\"currencies\"\n              .disabled=${this._working}\n              .value=${this._currencyValue}\n              @value-changed=${this._handleChange}\n            ></paper-input>\n          </div>\n        </div>\n\n      <div class=\"footer\">\n        <mwc-button @click=${this._save} .disabled=${this._working}>\n          ${this.onboardingLocalize(\n            \"ui.panel.page-onboarding.core-config.finish\"\n          )}\n        </mwc-button>\n      </div>\n    `;\n  }\n\n  protected firstUpdated(changedProps) {\n    super.firstUpdated(changedProps);\n    setTimeout(\n      () => this.shadowRoot!.querySelector(\"paper-input\")!.focus(),\n      100\n    );\n    this.addEventListener(\"keypress\", (ev) => {\n      if (ev.keyCode === 13) {\n        this._save(ev);\n      }\n    });\n    const tzInput = this.shadowRoot!.querySelector(\n      \"[name=timeZone]\"\n    ) as PaperInputElement;\n    tzInput.inputElement.appendChild(createTimezoneListEl());\n\n    const cInput = this.shadowRoot!.querySelector(\n      \"[name=currency]\"\n    ) as PaperInputElement;\n    cInput.inputElement.appendChild(createCurrencyListEl());\n  }\n\n  private get _nameValue() {\n    return this._name !== undefined\n      ? this._name\n      : this.onboardingLocalize(\n          \"ui.panel.page-onboarding.core-config.location_name_default\"\n        );\n  }\n\n  private get _locationValue() {\n    return this._location || amsterdam;\n  }\n\n  private get _elevationValue() {\n    return this._elevation !== undefined ? this._elevation : 0;\n  }\n\n  private get _timeZoneValue() {\n    return this._timeZone;\n  }\n\n  private get _unitSystemValue() {\n    return this._unitSystem !== undefined ? this._unitSystem : \"metric\";\n  }\n\n  private get _currencyValue() {\n    return this._currency !== undefined ? this._currency : \"\";\n  }\n\n  private _markerLocation = memoizeOne(\n    (location: [number, number]): MarkerLocation[] => [\n      {\n        id: locationMarkerId,\n        latitude: location[0],\n        longitude: location[1],\n        location_editable: true,\n      },\n    ]\n  );\n\n  private _handleChange(ev: PolymerChangedEvent<string>) {\n    const target = ev.currentTarget as PaperInputElement;\n\n    let value = target.value;\n\n    if (target.name === \"currency\" && value) {\n      if (value in SYMBOL_TO_ISO) {\n        value = SYMBOL_TO_ISO[value];\n      }\n    }\n\n    this[`_${target.name}`] = value;\n  }\n\n  private _locationChanged(ev) {\n    this._location = ev.detail.location;\n  }\n\n  private _unitSystemChanged(ev: CustomEvent) {\n    this._unitSystem = (ev.target as HaRadio).value as \"metric\" | \"imperial\";\n  }\n\n  private async _detect() {\n    this._working = true;\n    try {\n      const values = await detectCoreConfig(this.hass);\n\n      if (values.latitude && values.longitude) {\n        this.map.addEventListener(\n          \"markers-updated\",\n          () => {\n            this.map.fitMarker(locationMarkerId);\n          },\n          {\n            once: true,\n          }\n        );\n        this._location = [Number(values.latitude), Number(values.longitude)];\n      }\n      if (values.elevation) {\n        this._elevation = String(values.elevation);\n      }\n      if (values.unit_system) {\n        this._unitSystem = values.unit_system;\n      }\n      if (values.time_zone) {\n        this._timeZone = values.time_zone;\n      }\n      if (values.currency) {\n        this._currency = values.currency;\n      }\n    } catch (err: any) {\n      alert(`Failed to detect location information: ${err.message}`);\n    } finally {\n      this._working = false;\n    }\n  }\n\n  private async _save(ev) {\n    ev.preventDefault();\n    this._working = true;\n    try {\n      const location = this._locationValue;\n      await saveCoreConfig(this.hass, {\n        location_name: this._nameValue,\n        latitude: location[0],\n        longitude: location[1],\n        elevation: Number(this._elevationValue),\n        unit_system: this._unitSystemValue,\n        time_zone: this._timeZoneValue || \"UTC\",\n        currency: this._currencyValue || \"EUR\",\n      });\n      const result = await onboardCoreConfigStep(this.hass);\n      fireEvent(this, \"onboarding-step\", {\n        type: \"core_config\",\n        result,\n      });\n    } catch (err: any) {\n      this._working = false;\n      alert(`Failed to save: ${err.message}`);\n    }\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      .row {\n        display: flex;\n        flex-direction: row;\n        margin: 0 -8px;\n        align-items: center;\n      }\n\n      .secondary {\n        color: var(--secondary-text-color);\n      }\n\n      ha-locations-editor {\n        height: 200px;\n      }\n\n      .flex {\n        flex: 1;\n      }\n\n      .middle-text {\n        margin: 24px 0;\n      }\n\n      .row > * {\n        margin: 0 8px;\n      }\n\n      .radio-group {\n        display: flex;\n        flex-direction: column;\n        flex: 1;\n      }\n\n      .footer {\n        margin-top: 16px;\n        text-align: right;\n      }\n      a {\n        color: var(--primary-color);\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"onboarding-core-config\": OnboardingCoreConfig;\n  }\n}\n"],"names":[],"sourceRoot":""}