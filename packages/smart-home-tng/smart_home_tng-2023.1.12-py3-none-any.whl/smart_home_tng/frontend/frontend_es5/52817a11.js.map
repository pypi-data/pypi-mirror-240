{"version":3,"file":"52817a11.js","mappings":";AA2DA;AACA;AAmBA;AACA;;AA8CA;;AAIA;;;;AAKA;;AAEA;AAGA;AAWA;;;;AAKA;;AAEA;;AAGA;;AAOA;AAiBA;AACA;AAmBA;AACA;;AC7LA;AACA;;AAGA;AACA;;AAGA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;;;ACxDA;;;AAOA;;AAGA;AACA;;AAGA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+CA;;ACOA;AACA;AAnFA;AAqFA;;AAEA;AAUA;;;AAGA;AACA;AACA;;;AAGA;;AAUA;;;AAGA;AACA;;;AAGA;AA1HA;;;;;AAkIA;AACA;;;AAMA;;;;;;;;;;;;;;;;;;;;;;;AA4EA","sources":["webpack://home-assistant-frontend/./src/dialogs/config-flow/show-dialog-config-flow.ts","webpack://home-assistant-frontend/./src/onboarding/action-badge.ts","webpack://home-assistant-frontend/./src/onboarding/integration-badge.ts","webpack://home-assistant-frontend/./src/onboarding/onboarding-integrations.ts"],"sourcesContent":["import { html } from \"lit\";\nimport {\n  createConfigFlow,\n  deleteConfigFlow,\n  fetchConfigFlow,\n  getConfigFlowHandlers,\n  handleConfigFlowStep,\n} from \"../../data/config_flow\";\nimport { domainToName } from \"../../data/integration\";\nimport { getSupportedBrands } from \"../../data/supported_brands\";\nimport {\n  DataEntryFlowDialogParams,\n  loadDataEntryFlowDialog,\n  showFlowDialog,\n} from \"./show-dialog-data-entry-flow\";\n\nexport const loadConfigFlowDialog = loadDataEntryFlowDialog;\n\nexport const showConfigFlowDialog = (\n  element: HTMLElement,\n  dialogParams: Omit<DataEntryFlowDialogParams, \"flowConfig\">\n): void =>\n  showFlowDialog(element, dialogParams, {\n    loadDevicesAndAreas: true,\n    getFlowHandlers: async (hass) => {\n      const [integrations, helpers, supportedBrands] = await Promise.all([\n        getConfigFlowHandlers(hass, \"integration\"),\n        getConfigFlowHandlers(hass, \"helper\"),\n        getSupportedBrands(hass),\n        hass.loadBackendTranslation(\"title\", undefined, true),\n      ]);\n\n      return { integrations, helpers, supportedBrands };\n    },\n    createFlow: async (hass, handler) => {\n      const [step] = await Promise.all([\n        createConfigFlow(hass, handler),\n        hass.loadBackendTranslation(\"config\", handler),\n        // Used as fallback if no header defined for step\n        hass.loadBackendTranslation(\"title\", handler),\n      ]);\n      return step;\n    },\n    fetchFlow: async (hass, flowId) => {\n      const step = await fetchConfigFlow(hass, flowId);\n      await hass.loadBackendTranslation(\"config\", step.handler);\n      return step;\n    },\n    handleFlowStep: handleConfigFlowStep,\n    deleteFlow: deleteConfigFlow,\n\n    renderAbortDescription(hass, step) {\n      const description = hass.localize(\n        `component.${step.handler}.config.abort.${step.reason}`,\n        step.description_placeholders\n      );\n\n      return description\n        ? html`\n            <ha-markdown allowsvg breaks .content=${description}></ha-markdown>\n          `\n        : \"\";\n    },\n\n    renderShowFormStepHeader(hass, step) {\n      return (\n        hass.localize(\n          `component.${step.handler}.config.step.${step.step_id}.title`\n        ) || hass.localize(`component.${step.handler}.title`)\n      );\n    },\n\n    renderShowFormStepDescription(hass, step) {\n      const description = hass.localize(\n        `component.${step.handler}.config.step.${step.step_id}.description`,\n        step.description_placeholders\n      );\n      return description\n        ? html`\n            <ha-markdown allowsvg breaks .content=${description}></ha-markdown>\n          `\n        : \"\";\n    },\n\n    renderShowFormStepFieldLabel(hass, step, field) {\n      return hass.localize(\n        `component.${step.handler}.config.step.${step.step_id}.data.${field.name}`\n      );\n    },\n\n    renderShowFormStepFieldHelper(hass, step, field) {\n      const description = hass.localize(\n        `component.${step.handler}.config.step.${step.step_id}.data_description.${field.name}`,\n        step.description_placeholders\n      );\n      return description\n        ? html`<ha-markdown breaks .content=${description}></ha-markdown>`\n        : \"\";\n    },\n\n    renderShowFormStepFieldError(hass, step, error) {\n      return hass.localize(\n        `component.${step.handler}.config.error.${error}`,\n        step.description_placeholders\n      );\n    },\n\n    renderExternalStepHeader(hass, step) {\n      return (\n        hass.localize(\n          `component.${step.handler}.config.step.${step.step_id}.title`\n        ) ||\n        hass.localize(\n          \"ui.panel.config.integrations.config_flow.external_step.open_site\"\n        )\n      );\n    },\n\n    renderExternalStepDescription(hass, step) {\n      const description = hass.localize(\n        `component.${step.handler}.config.${step.step_id}.description`,\n        step.description_placeholders\n      );\n\n      return html`\n        <p>\n          ${hass.localize(\n            \"ui.panel.config.integrations.config_flow.external_step.description\"\n          )}\n        </p>\n        ${description\n          ? html`\n              <ha-markdown\n                allowsvg\n                breaks\n                .content=${description}\n              ></ha-markdown>\n            `\n          : \"\"}\n      `;\n    },\n\n    renderCreateEntryDescription(hass, step) {\n      const description = hass.localize(\n        `component.${step.handler}.config.create_entry.${\n          step.description || \"default\"\n        }`,\n        step.description_placeholders\n      );\n\n      return html`\n        ${description\n          ? html`\n              <ha-markdown\n                allowsvg\n                breaks\n                .content=${description}\n              ></ha-markdown>\n            `\n          : \"\"}\n        <p>\n          ${hass.localize(\n            \"ui.panel.config.integrations.config_flow.created_config\",\n            \"name\",\n            step.title\n          )}\n        </p>\n      `;\n    },\n\n    renderShowFormProgressHeader(hass, step) {\n      return (\n        hass.localize(\n          `component.${step.handler}.config.step.${step.step_id}.title`\n        ) || hass.localize(`component.${step.handler}.title`)\n      );\n    },\n\n    renderShowFormProgressDescription(hass, step) {\n      const description = hass.localize(\n        `component.${step.handler}.config.progress.${step.progress_action}`,\n        step.description_placeholders\n      );\n      return description\n        ? html`\n            <ha-markdown allowsvg breaks .content=${description}></ha-markdown>\n          `\n        : \"\";\n    },\n\n    renderMenuHeader(hass, step) {\n      return (\n        hass.localize(\n          `component.${step.handler}.config.step.${step.step_id}.title`\n        ) || hass.localize(`component.${step.handler}.title`)\n      );\n    },\n\n    renderMenuDescription(hass, step) {\n      const description = hass.localize(\n        `component.${step.handler}.config.step.${step.step_id}.description`,\n        step.description_placeholders\n      );\n      return description\n        ? html`\n            <ha-markdown allowsvg breaks .content=${description}></ha-markdown>\n          `\n        : \"\";\n    },\n\n    renderMenuOption(hass, step, option) {\n      return hass.localize(\n        `component.${step.handler}.config.step.${step.step_id}.menu_options.${option}`,\n        step.description_placeholders\n      );\n    },\n\n    renderLoadingDescription(hass, reason, handler, step) {\n      if (![\"loading_flow\", \"loading_step\"].includes(reason)) {\n        return \"\";\n      }\n      const domain = step?.handler || handler;\n      return hass.localize(\n        `ui.panel.config.integrations.config_flow.loading.${reason}`,\n        {\n          integration: domain\n            ? domainToName(hass.localize, domain)\n            : // when we are continuing a config flow, we only know the ID and not the domain\n              hass.localize(\n                \"ui.panel.config.integrations.config_flow.loading.fallback_title\"\n              ),\n        }\n      );\n    },\n  });\n","import { css, CSSResultGroup, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport \"../components/ha-svg-icon\";\n\n@customElement(\"action-badge\")\nclass ActionBadge extends LitElement {\n  @property() public icon!: string;\n\n  @property() public title!: string;\n\n  @property() public badgeIcon?: string;\n\n  @property({ type: Boolean, reflect: true }) public clickable = false;\n\n  protected render(): TemplateResult {\n    return html`\n      <div class=\"icon\">\n        <ha-svg-icon .path=${this.icon}></ha-svg-icon>\n        ${this.badgeIcon\n          ? html`<ha-svg-icon\n              class=\"badge\"\n              .path=${this.badgeIcon}\n            ></ha-svg-icon>`\n          : \"\"}\n      </div>\n      <div class=\"title\">${this.title}</div>\n    `;\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      :host {\n        display: inline-flex;\n        flex-direction: column;\n        text-align: center;\n        color: var(--primary-text-color);\n      }\n\n      :host([clickable]) {\n        color: var(--primary-text-color);\n      }\n\n      .icon {\n        position: relative;\n        box-sizing: border-box;\n        margin: 0 auto 8px;\n        height: 40px;\n        width: 40px;\n        border-radius: 50%;\n        border: 1px solid var(--secondary-text-color);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      :host([clickable]) .icon {\n        border-color: var(--primary-color);\n        border-width: 2px;\n      }\n\n      .badge {\n        position: absolute;\n        color: var(--primary-color);\n        bottom: -5px;\n        right: -5px;\n        background-color: white;\n        border-radius: 50%;\n        width: 18px;\n        display: block;\n        height: 18px;\n      }\n\n      .title {\n        min-height: 2.3em;\n        word-break: break-word;\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"action-badge\": ActionBadge;\n  }\n}\n","import { css, CSSResultGroup, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport \"../components/ha-svg-icon\";\nimport { brandsUrl } from \"../util/brands-url\";\n\n@customElement(\"integration-badge\")\nclass IntegrationBadge extends LitElement {\n  @property() public domain!: string;\n\n  @property() public title!: string;\n\n  @property() public badgeIcon?: string;\n\n  @property({ type: Boolean }) public darkOptimizedIcon?: boolean;\n\n  @property({ type: Boolean, reflect: true }) public clickable = false;\n\n  protected render(): TemplateResult {\n    return html`\n      <div class=\"icon\">\n        <img\n          src=${brandsUrl({\n            domain: this.domain,\n            type: \"icon\",\n            darkOptimized: this.darkOptimizedIcon,\n          })}\n          referrerpolicy=\"no-referrer\"\n        />\n        ${this.badgeIcon\n          ? html`<ha-svg-icon\n              class=\"badge\"\n              .path=${this.badgeIcon}\n            ></ha-svg-icon>`\n          : \"\"}\n      </div>\n      <div class=\"title\">${this.title}</div>\n    `;\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      :host {\n        display: inline-flex;\n        flex-direction: column;\n        text-align: center;\n        color: var(--primary-text-color);\n      }\n\n      :host([clickable]) {\n        color: var(--primary-text-color);\n      }\n\n      img {\n        max-width: 100%;\n        max-height: 100%;\n      }\n\n      .icon {\n        position: relative;\n        margin: 0 auto 8px;\n        height: 40px;\n        width: 40px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .badge {\n        position: absolute;\n        color: white;\n        bottom: -7px;\n        right: -10px;\n        background-color: var(--label-badge-green);\n        border-radius: 50%;\n        display: block;\n        --mdc-icon-size: 18px;\n        border: 2px solid white;\n      }\n\n      .title {\n        min-height: 2.3em;\n        word-break: break-word;\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"integration-badge\": IntegrationBadge;\n  }\n}\n","import \"@material/mwc-button/mwc-button\";\nimport {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  PropertyValues,\n  TemplateResult,\n} from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { mdiCheck, mdiDotsHorizontal } from \"@mdi/js\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { stringCompare } from \"../common/string/compare\";\nimport { isComponentLoaded } from \"../common/config/is_component_loaded\";\nimport { LocalizeFunc } from \"../common/translations/localize\";\nimport { ConfigEntry, getConfigEntries } from \"../data/config_entries\";\nimport {\n  getConfigFlowInProgressCollection,\n  localizeConfigFlowTitle,\n  subscribeConfigFlowInProgress,\n} from \"../data/config_flow\";\nimport { DataEntryFlowProgress } from \"../data/data_entry_flow\";\nimport { domainToName } from \"../data/integration\";\nimport { scanUSBDevices } from \"../data/usb\";\nimport {\n  loadConfigFlowDialog,\n  showConfigFlowDialog,\n} from \"../dialogs/config-flow/show-dialog-config-flow\";\nimport { HomeAssistant } from \"../types\";\nimport \"./action-badge\";\nimport \"./integration-badge\";\n\nconst HIDDEN_DOMAINS = new Set([\n  \"hassio\",\n  \"met\",\n  \"radio_browser\",\n  \"rpi_power\",\n  \"sun\",\n]);\n\n@customElement(\"onboarding-integrations\")\nclass OnboardingIntegrations extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property() public onboardingLocalize!: LocalizeFunc;\n\n  @state() private _entries?: ConfigEntry[];\n\n  @state() private _discovered?: DataEntryFlowProgress[];\n\n  private _unsubEvents?: () => void;\n\n  public connectedCallback() {\n    super.connectedCallback();\n    this.hass.loadBackendTranslation(\"title\", undefined, true);\n    this._unsubEvents = subscribeConfigFlowInProgress(this.hass, (flows) => {\n      this._discovered = flows;\n      const integrations: Set<string> = new Set();\n      for (const flow of flows) {\n        // To render title placeholders\n        if (flow.context.title_placeholders) {\n          integrations.add(flow.handler);\n        }\n      }\n      this.hass.loadBackendTranslation(\"config\", Array.from(integrations));\n    });\n  }\n\n  public disconnectedCallback() {\n    super.disconnectedCallback();\n    if (this._unsubEvents) {\n      this._unsubEvents();\n      this._unsubEvents = undefined;\n    }\n  }\n\n  protected render(): TemplateResult {\n    if (!this._entries || !this._discovered) {\n      return html``;\n    }\n    // Render discovered and existing entries together sorted by localized title.\n    const entries: Array<[string, TemplateResult]> = this._entries.map(\n      (entry) => {\n        const title =\n          entry.title ||\n          domainToName(this.hass.localize, entry.domain) ||\n          entry.domain;\n        return [\n          title,\n          html`\n            <integration-badge\n              .domain=${entry.domain}\n              .title=${title}\n              .badgeIcon=${mdiCheck}\n              .darkOptimizedIcon=${this.hass.themes?.darkMode}\n            ></integration-badge>\n          `,\n        ];\n      }\n    );\n    const discovered: Array<[string, TemplateResult]> = this._discovered.map(\n      (flow) => {\n        const title = localizeConfigFlowTitle(this.hass.localize, flow);\n        return [\n          title,\n          html`\n            <button .flowId=${flow.flow_id} @click=${this._continueFlow}>\n              <integration-badge\n                clickable\n                .domain=${flow.handler}\n                .title=${title}\n                .darkOptimizedIcon=${this.hass.themes?.darkMode}\n              ></integration-badge>\n            </button>\n          `,\n        ];\n      }\n    );\n    const content = [...entries, ...discovered]\n      .sort((a, b) => stringCompare(a[0], b[0]))\n      .map((item) => item[1]);\n\n    return html`\n      <p>\n        ${this.onboardingLocalize(\"ui.panel.page-onboarding.integration.intro\")}\n      </p>\n      <div class=\"badges\">\n        ${content}\n        <button @click=${this._createFlow}>\n          <action-badge\n            clickable\n            title=${this.onboardingLocalize(\n              \"ui.panel.page-onboarding.integration.more_integrations\"\n            )}\n            .icon=${mdiDotsHorizontal}\n          ></action-badge>\n        </button>\n      </div>\n      <div class=\"footer\">\n        <mwc-button @click=${this._finish}>\n          ${this.onboardingLocalize(\n            \"ui.panel.page-onboarding.integration.finish\"\n          )}\n        </mwc-button>\n      </div>\n    `;\n  }\n\n  protected firstUpdated(changedProps: PropertyValues) {\n    super.firstUpdated(changedProps);\n    this._scanUSBDevices();\n    loadConfigFlowDialog();\n    this._loadConfigEntries();\n  }\n\n  private _createFlow() {\n    showConfigFlowDialog(this, {\n      dialogClosedCallback: () => {\n        this._loadConfigEntries();\n        getConfigFlowInProgressCollection(this.hass!.connection).refresh();\n      },\n    });\n  }\n\n  private _continueFlow(ev) {\n    showConfigFlowDialog(this, {\n      continueFlowId: ev.currentTarget.flowId,\n      dialogClosedCallback: () => {\n        this._loadConfigEntries();\n        getConfigFlowInProgressCollection(this.hass!.connection).refresh();\n      },\n    });\n  }\n\n  private async _scanUSBDevices() {\n    if (!isComponentLoaded(this.hass, \"usb\")) {\n      return;\n    }\n    await scanUSBDevices(this.hass);\n  }\n\n  private async _loadConfigEntries() {\n    const entries = await getConfigEntries(this.hass!, { type: \"integration\" });\n    // We filter out the config entries that are automatically created during onboarding.\n    // It is one that we create automatically and it will confuse the user\n    // if it starts showing up during onboarding.\n    this._entries = entries.filter(\n      (entry) => !HIDDEN_DOMAINS.has(entry.domain)\n    );\n  }\n\n  private async _finish() {\n    fireEvent(this, \"onboarding-step\", {\n      type: \"integration\",\n    });\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      .badges {\n        margin-top: 24px;\n        display: flex;\n        flex-direction: row;\n        flex-wrap: wrap;\n        justify-content: flex-start;\n        align-items: flex-start;\n      }\n      .badges > * {\n        width: 96px;\n        margin-bottom: 24px;\n      }\n      button {\n        cursor: pointer;\n        padding: 0;\n        border: 0;\n        background: 0;\n        font: inherit;\n      }\n      .footer {\n        text-align: right;\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"onboarding-integrations\": OnboardingIntegrations;\n  }\n}\n"],"names":[],"sourceRoot":""}