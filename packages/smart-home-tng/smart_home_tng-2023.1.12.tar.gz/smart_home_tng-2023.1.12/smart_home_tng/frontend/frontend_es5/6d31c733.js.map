{"version":3,"file":"6d31c733.js","mappings":";;AAqCA;AACA;AACA;;;AAGA;;AAEA;;;;AAMA;;;AAKA;;;;AAMA;;;AAKA;;;AAKA;;;AAKA;;;;AAMA;;;;AAMA;;;AAKA;;;;;;;;;AAWA;;;;;;;;;AAWA;;;;;;;AASA;;AAIA;;;;AAMA;;;AAKA;AACA;AACA;;;;;AAOA;;;;AAIA;AACA;;;;;AAOA;AACA;AACA;;;;AAMA;AACA;;AAEA;;;;;;;AAUA;;;;;;;;;;;;;;;;;;;;;;AAsGA","sources":["webpack://home-assistant-frontend/./src/panels/config/cloud/register/cloud-register.ts"],"sourcesContent":["import { css, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators\";\nimport { fireEvent } from \"../../../../common/dom/fire_event\";\nimport \"../../../../components/buttons/ha-progress-button\";\nimport \"../../../../components/ha-alert\";\nimport \"../../../../components/ha-card\";\nimport \"../../../../components/ha-textfield\";\nimport type { HaTextField } from \"../../../../components/ha-textfield\";\nimport { cloudRegister, cloudResendVerification } from \"../../../../data/cloud\";\nimport \"../../../../layouts/hass-subpage\";\nimport { haStyle } from \"../../../../resources/styles\";\nimport { HomeAssistant } from \"../../../../types\";\nimport \"../../ha-config-section\";\n\n@customElement(\"cloud-register\")\nexport class CloudRegister extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ type: Boolean }) public isWide = false;\n\n  @property({ type: Boolean }) public narrow = false;\n\n  @property() public email?: string;\n\n  @state() private _requestInProgress = false;\n\n  @state() private _password = \"\";\n\n  @state() private _error?: string;\n\n  @query(\"#email\", true) private _emailField!: HaTextField;\n\n  @query(\"#password\", true) private _passwordField!: HaTextField;\n\n  protected render(): TemplateResult {\n    return html`\n      <hass-subpage\n        .hass=${this.hass}\n        .narrow=${this.narrow}\n        .header=${this.hass.localize(\"ui.panel.config.cloud.register.title\")}\n      >\n        <div class=\"content\">\n          <ha-config-section .isWide=${this.isWide}>\n            <span slot=\"header\"\n              >${this.hass.localize(\n                \"ui.panel.config.cloud.register.headline\"\n              )}</span\n            >\n            <div slot=\"introduction\">\n              <p>\n                ${this.hass.localize(\n                  \"ui.panel.config.cloud.register.information\"\n                )}\n              </p>\n              <p>\n                ${this.hass.localize(\n                  \"ui.panel.config.cloud.register.information2\"\n                )}\n              </p>\n              <ul>\n                <li>\n                  ${this.hass.localize(\n                    \"ui.panel.config.cloud.register.feature_remote_control\"\n                  )}\n                </li>\n                <li>\n                  ${this.hass.localize(\n                    \"ui.panel.config.cloud.register.feature_google_home\"\n                  )}\n                </li>\n                <li>\n                  ${this.hass.localize(\n                    \"ui.panel.config.cloud.register.feature_amazon_alexa\"\n                  )}\n                </li>\n                <li>\n                  ${this.hass.localize(\n                    \"ui.panel.config.cloud.register.feature_webhook_apps\"\n                  )}\n                </li>\n              </ul>\n              <p>\n                ${this.hass.localize(\n                  \"ui.panel.config.cloud.register.information3\"\n                )}\n                <a href=\"https://www.nabucasa.com\" target=\"_blank\"\n                  >Nabu&nbsp;Casa,&nbsp;Inc</a\n                >\n                ${this.hass.localize(\n                  \"ui.panel.config.cloud.register.information3a\"\n                )}\n              </p>\n              <p>\n                ${this.hass.localize(\n                  \"ui.panel.config.cloud.register.information4\"\n                )}\n              </p>\n              <ul>\n                <li>\n                  <a\n                    href=\"https://www.nabucasa.com/tos/\"\n                    target=\"_blank\"\n                    rel=\"noreferrer\"\n                  >\n                    ${this.hass.localize(\n                      \"ui.panel.config.cloud.register.link_terms_conditions\"\n                    )}\n                  </a>\n                </li>\n                <li>\n                  <a\n                    href=\"https://www.nabucasa.com/privacy_policy/\"\n                    target=\"_blank\"\n                    rel=\"noreferrer\"\n                  >\n                    ${this.hass.localize(\n                      \"ui.panel.config.cloud.register.link_privacy_policy\"\n                    )}\n                  </a>\n                </li>\n              </ul>\n            </div>\n            <ha-card\n              outlined\n              .header=${this.hass.localize(\n                \"ui.panel.config.cloud.register.create_account\"\n              )}\n              ><div class=\"card-content register-form\">\n                ${this._error\n                  ? html`<ha-alert alert-type=\"error\">${this._error}</ha-alert>`\n                  : \"\"}\n                <ha-textfield\n                  autofocus\n                  id=\"email\"\n                  .label=${this.hass.localize(\n                    \"ui.panel.config.cloud.register.email_address\"\n                  )}\n                  type=\"email\"\n                  required\n                  .value=${this.email}\n                  @keydown=${this._keyDown}\n                  validationMessage=${this.hass.localize(\n                    \"ui.panel.config.cloud.register.email_error_msg\"\n                  )}\n                ></ha-textfield>\n                <ha-textfield\n                  id=\"password\"\n                  label=\"Password\"\n                  .value=${this._password}\n                  type=\"password\"\n                  minlength=\"8\"\n                  required\n                  @keydown=${this._keyDown}\n                  validationMessage=${this.hass.localize(\n                    \"ui.panel.config.cloud.register.password_error_msg\"\n                  )}\n                ></ha-textfield>\n              </div>\n              <div class=\"card-actions\">\n                <ha-progress-button\n                  @click=${this._handleRegister}\n                  .progress=${this._requestInProgress}\n                  >${this.hass.localize(\n                    \"ui.panel.config.cloud.register.start_trial\"\n                  )}</ha-progress-button\n                >\n                <button\n                  class=\"link\"\n                  .disabled=${this._requestInProgress}\n                  @click=${this._handleResendVerifyEmail}\n                >\n                  ${this.hass.localize(\n                    \"ui.panel.config.cloud.register.resend_confirm_email\"\n                  )}\n                </button>\n              </div>\n            </ha-card>\n          </ha-config-section>\n        </div>\n      </hass-subpage>\n    `;\n  }\n\n  private _keyDown(ev: KeyboardEvent) {\n    if (ev.key === \"Enter\") {\n      this._handleRegister();\n    }\n  }\n\n  private async _handleRegister() {\n    const emailField = this._emailField;\n    const passwordField = this._passwordField;\n\n    const email = emailField.value;\n    const password = passwordField.value;\n\n    if (!emailField.reportValidity()) {\n      passwordField.reportValidity();\n      emailField.focus();\n      return;\n    }\n\n    if (!passwordField.reportValidity()) {\n      passwordField.focus();\n      return;\n    }\n\n    this._requestInProgress = true;\n\n    try {\n      await cloudRegister(this.hass, email, password);\n      this._verificationEmailSent(email);\n    } catch (err: any) {\n      this._password = \"\";\n      this._requestInProgress = false;\n      this._error =\n        err && err.body && err.body.message\n          ? err.body.message\n          : \"Unknown error\";\n    }\n  }\n\n  private async _handleResendVerifyEmail() {\n    const emailField = this._emailField;\n\n    const email = emailField.value;\n\n    if (!emailField.reportValidity()) {\n      emailField.focus();\n      return;\n    }\n\n    try {\n      await cloudResendVerification(this.hass, email);\n      this._verificationEmailSent(email);\n    } catch (err: any) {\n      this._error =\n        err && err.body && err.body.message\n          ? err.body.message\n          : \"Unknown error\";\n    }\n  }\n\n  private _verificationEmailSent(email: string) {\n    this._requestInProgress = false;\n    this._password = \"\";\n    // @ts-ignore\n    fireEvent(this, \"email-changed\", { value: email });\n    // @ts-ignore\n    fireEvent(this, \"cloud-done\", {\n      flashMessage: this.hass.localize(\n        \"ui.panel.config.cloud.register.account_created\"\n      ),\n    });\n  }\n\n  static get styles() {\n    return [\n      haStyle,\n      css`\n        [slot=\"introduction\"] {\n          margin: -1em 0;\n        }\n        [slot=\"introduction\"] a {\n          color: var(--primary-color);\n        }\n        a {\n          color: var(--primary-color);\n        }\n        h1 {\n          margin: 0;\n        }\n        .register-form {\n          display: flex;\n          flex-direction: column;\n        }\n        .card-actions {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"cloud-register\": CloudRegister;\n  }\n}\n"],"names":[],"sourceRoot":""}