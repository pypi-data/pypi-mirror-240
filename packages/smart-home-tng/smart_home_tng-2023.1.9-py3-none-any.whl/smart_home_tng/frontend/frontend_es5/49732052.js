/*! For license information please see 49732052.js.LICENSE.txt */
"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[31858],{31858:function(e,t,r){function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=o(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw i}}}}function a(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i,o,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(){c=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof b?t:b,o=Object.create(i.prototype),s=new D(n||[]);return a(o,"_invoke",{value:L(e,r,s)}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var v="suspendedStart",p="suspendedYield",y="executing",m="completed",g={};function b(){}function w(){}function _(){}var k={};l(k,o,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(T([])));S&&S!==r&&n.call(S,o)&&(k=S);var E=_.prototype=b.prototype=Object.create(k);function O(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function r(a,i,o,s){var c=f(e[a],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==h(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(l).then((function(e){u.value=e,o(u)}),(function(e){return r("throw",e,o,s)}))}s(c.arg)}var i;a(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,a){r(e,n,t,a)}))}return i=i?i.then(a,a):a()}})}function L(t,r,n){var a=v;return function(i,o){if(a===y)throw new Error("Generator is already running");if(a===m){if("throw"===i)throw o;return{value:e,done:!0}}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var c=$(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===v)throw a=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=y;var u=f(t,r,n);if("normal"===u.type){if(a=n.done?m:p,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=m,n.method="throw",n.arg=u.arg)}}}function $(t,r){var n=r.method,a=t.iterator[n];if(a===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,$(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=f(a,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var o=i.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function T(t){if(t||""===t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(h(t)+" is not iterable")}return w.prototype=_,a(E,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},O(C.prototype),l(C.prototype,s,(function(){return this})),t.AsyncIterator=C,t.async=function(e,r,n,a,i){void 0===i&&(i=Promise);var o=new C(d(e,r,n,a),i);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},O(E),l(E,u,"Generator"),l(E,o,(function(){return this})),l(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=T,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(n,a){return s.type="throw",s.arg=t,r.next=n,a&&(r.method="next",r.arg=e),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;P(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:T(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function u(e,t,r,n,a,i,o){try{var s=e[i](o),c=s.value}catch(u){return void r(u)}s.done?t(c):Promise.resolve(c).then(n,a)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){u(i,n,a,o,s,"next",e)}function s(e){u(i,n,a,o,s,"throw",e)}o(void 0)}))}}function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e,t){if("object"!==h(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===h(t)?t:String(t)}r.r(t);var v=function(){function e(t,r,n,a,i){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._legacyCanvasSize=e.DEFAULT_CANVAS_SIZE,this._preferredCamera="environment",this._maxScansPerSecond=25,this._lastScanTimestamp=-1,this._destroyed=this._flashOn=this._paused=this._active=!1,this.$video=t,this.$canvas=document.createElement("canvas"),n&&"object"===h(n)?this._onDecode=r:(n||a||i?console.warn("You're using a deprecated version of the QrScanner constructor which will be removed in the future"):console.warn("Note that the type of the scan result passed to onDecode will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),this._legacyOnDecode=r),r="object"===h(n)?n:{},this._onDecodeError=r.onDecodeError||("function"==typeof n?n:this._onDecodeError),this._calculateScanRegion=r.calculateScanRegion||("function"==typeof a?a:this._calculateScanRegion),this._preferredCamera=r.preferredCamera||i||this._preferredCamera,this._legacyCanvasSize="number"==typeof n?n:"number"==typeof a?a:this._legacyCanvasSize,this._maxScansPerSecond=r.maxScansPerSecond||this._maxScansPerSecond,this._onPlay=this._onPlay.bind(this),this._onLoadedMetaData=this._onLoadedMetaData.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this._updateOverlay=this._updateOverlay.bind(this),t.disablePictureInPicture=!0,t.playsInline=!0,t.muted=!0;var s=!1;if(t.hidden&&(t.hidden=!1,s=!0),document.body.contains(t)||(document.body.appendChild(t),s=!0),n=t.parentElement,r.highlightScanRegion||r.highlightCodeOutline){if(a=!!r.overlay,this.$overlay=r.overlay||document.createElement("div"),(i=this.$overlay.style).position="absolute",i.display="none",i.pointerEvents="none",this.$overlay.classList.add("scan-region-highlight"),!a&&r.highlightScanRegion){this.$overlay.innerHTML='<svg class="scan-region-highlight-svg" viewBox="0 0 238 238" preserveAspectRatio="none" style="position:absolute;width:100%;height:100%;left:0;top:0;fill:none;stroke:#e9b213;stroke-width:4;stroke-linecap:round;stroke-linejoin:round"><path d="M31 2H10a8 8 0 0 0-8 8v21M207 2h21a8 8 0 0 1 8 8v21m0 176v21a8 8 0 0 1-8 8h-21m-176 0H10a8 8 0 0 1-8-8v-21"/></svg>';try{this.$overlay.firstElementChild.animate({transform:["scale(.98)","scale(1.01)"]},{duration:400,iterations:1/0,direction:"alternate",easing:"ease-in-out"})}catch(c){}n.insertBefore(this.$overlay,this.$video.nextSibling)}r.highlightCodeOutline&&(this.$overlay.insertAdjacentHTML("beforeend",'<svg class="code-outline-highlight" preserveAspectRatio="none" style="display:none;width:100%;height:100%;fill:none;stroke:#e9b213;stroke-width:5;stroke-dasharray:25;stroke-linecap:round;stroke-linejoin:round"><polygon/></svg>'),this.$codeOutlineHighlight=this.$overlay.lastElementChild)}this._scanRegion=this._calculateScanRegion(t),requestAnimationFrame((function(){var e=window.getComputedStyle(t);"none"===e.display&&(t.style.setProperty("display","block","important"),s=!0),"visible"!==e.visibility&&(t.style.setProperty("visibility","visible","important"),s=!0),s&&(console.warn("QrScanner has overwritten the video hiding style to avoid Safari stopping the playback."),t.style.opacity="0",t.style.width="0",t.style.height="0",o.$overlay&&o.$overlay.parentElement&&o.$overlay.parentElement.removeChild(o.$overlay),delete o.$overlay,delete o.$codeOutlineHighlight),o.$overlay&&o._updateOverlay()})),t.addEventListener("play",this._onPlay),t.addEventListener("loadedmetadata",this._onLoadedMetaData),document.addEventListener("visibilitychange",this._onVisibilityChange),window.addEventListener("resize",this._updateOverlay),this._qrEnginePromise=e.createQrEngine()}var t,o,s,u,v,p,y,m,g,b,w,_,k,x,S,E,O,C,L;return t=e,o=[{key:"hasFlash",value:(L=l(c().mark((function t(){var r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.$video.srcObject){t.next=7;break}if(this.$video.srcObject instanceof MediaStream){t.next=4;break}return t.abrupt("return",!1);case 4:r=this.$video.srcObject,t.next=10;break;case 7:return t.next=9,this._getCameraStream();case 9:r=t.sent.stream;case 10:return t.abrupt("return","torch"in r.getVideoTracks()[0].getSettings());case 13:return t.prev=13,t.t0=t.catch(0),t.abrupt("return",!1);case 16:return t.prev=16,r&&r!==this.$video.srcObject&&(console.warn("Call hasFlash after successfully starting the scanner to avoid creating a temporary video stream"),e._stopVideoStream(r)),t.finish(16);case 19:case"end":return t.stop()}}),t,this,[[0,13,16,19]])}))),function(){return L.apply(this,arguments)})},{key:"isFlashOn",value:function(){return this._flashOn}},{key:"toggleFlash",value:(C=l(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._flashOn){e.next=5;break}return e.next=3,this.turnFlashOff();case 3:e.next=7;break;case 5:return e.next=7,this.turnFlashOn();case 7:case"end":return e.stop()}}),e,this)}))),function(){return C.apply(this,arguments)})},{key:"turnFlashOn",value:(O=l(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._flashOn||this._destroyed||(this._flashOn=!0,!this._active||this._paused)){e.next=13;break}return e.prev=1,e.next=4,this.hasFlash();case 4:if(e.sent){e.next=6;break}throw"No flash available";case 6:return e.next=8,this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:!0}]});case 8:e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(1),this._flashOn=!1,e.t0;case 13:case"end":return e.stop()}}),e,this,[[1,10]])}))),function(){return O.apply(this,arguments)})},{key:"turnFlashOff",value:(E=l(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this._flashOn,!e.t0){e.next=5;break}return this._flashOn=!1,e.next=5,this._restartVideoStream();case 5:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"destroy",value:function(){this.$video.removeEventListener("loadedmetadata",this._onLoadedMetaData),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("resize",this._updateOverlay),this._destroyed=!0,this._flashOn=!1,this.stop(),e._postWorkerMessage(this._qrEnginePromise,"close")}},{key:"start",value:(S=l(c().mark((function t(){var r,n,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._destroyed){t.next=2;break}throw Error("The QR scanner can not be started as it had been destroyed.");case 2:if(this._active&&!this._paused){t.next=30;break}if("https:"!==window.location.protocol&&console.warn("The camera stream is only accessible if the page is transferred via https."),this._active=!0,document.hidden){t.next=30;break}if(this._paused=!1,!this.$video.srcObject){t.next=9;break}return t.next=7,this.$video.play();case 7:t.next=30;break;case 9:return t.prev=9,t.next=12,this._getCameraStream();case 12:if(r=t.sent,n=r.stream,a=r.facingMode,this._active&&!this._paused){t.next=19;break}e._stopVideoStream(n),t.next=24;break;case 19:return this._setVideoMirror(a),this.$video.srcObject=n,t.next=23,this.$video.play();case 23:this._flashOn&&(this._flashOn=!1,this.turnFlashOn().catch((function(){})));case 24:t.next=30;break;case 26:if(t.prev=26,t.t0=t.catch(9),this._paused){t.next=30;break}throw this._active=!1,t.t0;case 30:case"end":return t.stop()}}),t,this,[[9,26]])}))),function(){return S.apply(this,arguments)})},{key:"stop",value:function(){this.pause(),this._active=!1}},{key:"pause",value:(x=l(c().mark((function t(){var r,n,a=this,i=arguments;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=i.length>0&&void 0!==i[0]&&i[0],this._paused=!0,this._active){t.next=4;break}return t.abrupt("return",!0);case 4:if(this.$video.pause(),this.$overlay&&(this.$overlay.style.display="none"),n=function(){a.$video.srcObject instanceof MediaStream&&(e._stopVideoStream(a.$video.srcObject),a.$video.srcObject=null)},!r){t.next=9;break}return t.abrupt("return",(n(),!0));case 9:return t.next=11,new Promise((function(e){return setTimeout(e,300)}));case 11:if(this._paused){t.next=13;break}return t.abrupt("return",!1);case 13:return n(),t.abrupt("return",!0);case 15:case"end":return t.stop()}}),t,this)}))),function(){return x.apply(this,arguments)})},{key:"setCamera",value:(k=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t!==this._preferredCamera,!e.t0){e.next=5;break}return this._preferredCamera=t,e.next=5,this._restartVideoStream();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"setGrayscaleWeights",value:function(t,r,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:t,green:r,blue:n,useIntegerApproximation:a})}},{key:"setInversionMode",value:function(t){e._postWorkerMessage(this._qrEnginePromise,"inversionMode",t)}},{key:"_onPlay",value:function(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay(),this.$overlay&&(this.$overlay.style.display=""),this._scanFrame()}},{key:"_onLoadedMetaData",value:function(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay()}},{key:"_onVisibilityChange",value:function(){document.hidden?this.pause():this._active&&this.start()}},{key:"_calculateScanRegion",value:function(e){var t=Math.round(2/3*Math.min(e.videoWidth,e.videoHeight));return{x:Math.round((e.videoWidth-t)/2),y:Math.round((e.videoHeight-t)/2),width:t,height:t,downScaledWidth:this._legacyCanvasSize,downScaledHeight:this._legacyCanvasSize}}},{key:"_updateOverlay",value:function(){var e=this;requestAnimationFrame((function(){if(e.$overlay){var t=e.$video,r=t.videoWidth,n=t.videoHeight,a=t.offsetWidth,o=t.offsetHeight,s=t.offsetLeft,c=t.offsetTop,u=window.getComputedStyle(t),l=u.objectFit,h=r/n,d=a/o;switch(l){case"none":var f=r,v=n;break;case"fill":f=a,v=o;break;default:("cover"===l?h>d:h<d)?f=(v=o)*h:v=(f=a)/h,"scale-down"===l&&(f=Math.min(f,r),v=Math.min(v,n))}var p=i(u.objectPosition.split(" ").map((function(e,t){var r=parseFloat(e);return e.endsWith("%")?(t?o-v:a-f)*r/100:r})),2),y=p[0],m=p[1];u=e._scanRegion.width||r,d=e._scanRegion.height||n,l=e._scanRegion.x||0;var g=e._scanRegion.y||0;(h=e.$overlay.style).width="".concat(u/r*f,"px"),h.height="".concat(d/n*v,"px"),h.top="".concat(c+m+g/n*v,"px"),n=/scaleX\(-1\)/.test(t.style.transform),h.left="".concat(s+(n?a-y-f:y)+(n?r-l-u:l)/r*f,"px"),h.transform=t.style.transform}}))}},{key:"_scanFrame",value:function(){var t=this;!this._active||this.$video.paused||this.$video.ended||("requestVideoFrameCallback"in this.$video?this.$video.requestVideoFrameCallback.bind(this.$video):requestAnimationFrame)(l(c().mark((function r(){var n,a,i;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(1>=t.$video.readyState){r.next=29;break}if(n=Date.now()-t._lastScanTimestamp,a=1e3/t._maxScansPerSecond,r.t0=n<a,!r.t0){r.next=6;break}return r.next=6,new Promise((function(e){return setTimeout(e,a-n)}));case 6:return t._lastScanTimestamp=Date.now(),r.prev=7,r.next=10,e.scanImage(t.$video,{scanRegion:t._scanRegion,qrEngine:t._qrEnginePromise,canvas:t.$canvas});case 10:i=r.sent,r.next=18;break;case 13:if(r.prev=13,r.t1=r.catch(7),t._active){r.next=17;break}return r.abrupt("return");case 17:t._onDecodeError(r.t1);case 18:if(r.t2=!e._disableBarcodeDetector,r.t2){r.next=25;break}return r.next=22,t._qrEnginePromise;case 22:r.t3=r.sent,r.t4=Worker,r.t2=r.t3 instanceof r.t4;case 25:if(r.t5=r.t2,r.t5){r.next=28;break}t._qrEnginePromise=e.createQrEngine();case 28:i?(t._onDecode?t._onDecode(i):t._legacyOnDecode&&t._legacyOnDecode(i.data),t.$codeOutlineHighlight&&(clearTimeout(t._codeOutlineHighlightRemovalTimeout),t._codeOutlineHighlightRemovalTimeout=void 0,t.$codeOutlineHighlight.setAttribute("viewBox","".concat(t._scanRegion.x||0," ")+"".concat(t._scanRegion.y||0," ")+"".concat(t._scanRegion.width||t.$video.videoWidth," ")+"".concat(t._scanRegion.height||t.$video.videoHeight)),t.$codeOutlineHighlight.firstElementChild.setAttribute("points",i.cornerPoints.map((function(e){var t=e.x,r=e.y;return"".concat(t,",").concat(r)})).join(" ")),t.$codeOutlineHighlight.style.display="")):t.$codeOutlineHighlight&&!t._codeOutlineHighlightRemovalTimeout&&(t._codeOutlineHighlightRemovalTimeout=setTimeout((function(){return t.$codeOutlineHighlight.style.display="none"}),100));case 29:t._scanFrame();case 30:case"end":return r.stop()}}),r,null,[[7,13]])}))))}},{key:"_onDecodeError",value:function(t){t!==e.NO_QR_CODE_FOUND&&console.log(t)}},{key:"_getCameraStream",value:(_=l(c().mark((function e(){var t,r,n,i,o,s,u,l,h=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices){e.next=2;break}throw"Camera not found.";case 2:t=/^(environment|user)$/.test(this._preferredCamera)?"facingMode":"deviceId",n=(r=[{width:{min:1024}},{width:{min:768}},{}]).map((function(e){return Object.assign({},e,(r={},n=t,a={exact:h._preferredCamera},(n=f(n))in r?Object.defineProperty(r,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[n]=a,r));var r,n,a})),i=0,o=[].concat(a(n),r);case 4:if(!(i<o.length)){e.next=19;break}return s=o[i],e.prev=6,e.next=9,navigator.mediaDevices.getUserMedia({video:s,audio:!1});case 9:return u=e.sent,l=this._getFacingMode(u)||(s.facingMode?this._preferredCamera:"environment"===this._preferredCamera?"user":"environment"),e.abrupt("return",{stream:u,facingMode:l});case 14:e.prev=14,e.t0=e.catch(6);case 16:i++,e.next=4;break;case 19:throw"Camera not found.";case 20:case"end":return e.stop()}}),e,this,[[6,14]])}))),function(){return _.apply(this,arguments)})},{key:"_restartVideoStream",value:(w=l(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._paused,e.next=3,this.pause(!0);case 3:if(e.t1=e.sent,!e.t1){e.next=6;break}e.t1=!t;case 6:if(e.t0=e.t1,!e.t0){e.next=9;break}e.t0=this._active;case 9:if(e.t2=e.t0,!e.t2){e.next=13;break}return e.next=13,this.start();case 13:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"_setVideoMirror",value:function(e){this.$video.style.transform="scaleX("+("user"===e?-1:1)+")"}},{key:"_getFacingMode",value:function(e){return(e=e.getVideoTracks()[0])?/rear|back|environment/i.test(e.label)?"environment":/front|user|face/i.test(e.label)?"user":null:null}}],s=[{key:"WORKER_PATH",set:function(e){console.warn("Setting QrScanner.WORKER_PATH is not required and not supported anymore. Have a look at the README for new setup instructions.")}},{key:"hasCamera",value:(b=l(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.listCameras(!1);case 3:return t.abrupt("return",!!t.sent.length);case 6:return t.prev=6,t.t0=t.catch(0),t.abrupt("return",!1);case 9:case"end":return t.stop()}}),t,null,[[0,6]])}))),function(){return b.apply(this,arguments)})},{key:"listCameras",value:(g=l(c().mark((function t(){var r,n,a,i=arguments;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=i.length>0&&void 0!==i[0]&&i[0],navigator.mediaDevices){t.next=3;break}return t.abrupt("return",[]);case 3:if(n=function(){var e=l(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:return e.abrupt("return",e.sent.filter((function(e){return"videoinput"===e.kind})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t.prev=4,t.t0=r,!t.t0){t.next=10;break}return t.next=9,n();case 9:t.t0=t.sent.every((function(e){return!e.label}));case 10:if(t.t1=t.t0,!t.t1){t.next=15;break}return t.next=14,navigator.mediaDevices.getUserMedia({audio:!1,video:!0});case 14:a=t.sent;case 15:t.next=19;break;case 17:t.prev=17,t.t2=t.catch(4);case 19:return t.prev=19,t.next=22,n();case 22:return t.abrupt("return",t.sent.map((function(e,t){return{id:e.deviceId,label:e.label||(0===t?"Default Camera":"Camera ".concat(t+1))}})));case 23:return t.prev=23,a&&(console.warn("Call listCameras after successfully starting a QR scanner to avoid creating a temporary video stream"),e._stopVideoStream(a)),t.finish(23);case 26:case"end":return t.stop()}}),t,null,[[4,17],[19,,23,26]])}))),function(){return g.apply(this,arguments)})},{key:"scanImage",value:(m=l(c().mark((function t(r,n,a,o){var s,u,h,d,f,v,p,y,m,g,b,w,_,k=arguments;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=k.length>4&&void 0!==k[4]&&k[4],u=k.length>5&&void 0!==k[5]&&k[5],d=!1,n&&("scanRegion"in n||"qrEngine"in n||"canvas"in n||"disallowCanvasResizing"in n||"alsoTryWithoutScanRegion"in n||"returnDetailedScanResult"in n)?(h=n.scanRegion,a=n.qrEngine,o=n.canvas,s=n.disallowCanvasResizing||!1,u=n.alsoTryWithoutScanRegion||!1,d=!0):n||a||o||s||u?console.warn("You're using a deprecated api for scanImage which will be removed in the future."):console.warn("Note that the return type of scanImage will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),n=!!a,t.prev=5,t.next=8,Promise.all([a||e.createQrEngine(),e._loadImage(r)]);case 8:if(p=t.sent,y=i(p,2),a=y[0],f=y[1],m=e._drawToCanvas(f,h,o,s),g=i(m,2),o=g[0],v=g[1],!(a instanceof Worker)){t.next=24;break}return w=a,n||e._postWorkerMessageSync(w,"inversionMode","both"),t.next=21,new Promise((function(t,r){var n,a,i,s=-1;a=function(o){o.data.id===s&&(w.removeEventListener("message",a),w.removeEventListener("error",i),clearTimeout(n),null!==o.data.data?t({data:o.data.data,cornerPoints:e._convertPoints(o.data.cornerPoints,h)}):r(e.NO_QR_CODE_FOUND))},i=function(e){w.removeEventListener("message",a),w.removeEventListener("error",i),clearTimeout(n),r("Scanner error: "+(e?e.message||e:"Unknown Error"))},w.addEventListener("message",a),w.addEventListener("error",i),n=setTimeout((function(){return i("timeout")}),1e4);var c=v.getImageData(0,0,o.width,o.height);s=e._postWorkerMessageSync(w,"decode",c,[c.data.buffer])}));case 21:b=t.sent,t.next=27;break;case 24:return t.next=26,Promise.race([new Promise((function(e,t){return window.setTimeout((function(){return t("Scanner error: timeout")}),1e4)})),l(c().mark((function t(){var n,l,d;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,a.detect(o);case 3:if(n=t.sent,l=i(n,1),d=l[0]){t.next=8;break}throw e.NO_QR_CODE_FOUND;case 8:return t.abrupt("return",{data:d.rawValue,cornerPoints:e._convertPoints(d.cornerPoints,h)});case 11:if(t.prev=11,t.t0=t.catch(0),d=t.t0.message||t.t0,!/not implemented|service unavailable/.test(d)){t.next=16;break}return t.abrupt("return",(e._disableBarcodeDetector=!0,e.scanImage(r,{scanRegion:h,canvas:o,disallowCanvasResizing:s,alsoTryWithoutScanRegion:u})));case 16:throw"Scanner error: ".concat(d);case 17:case"end":return t.stop()}}),t,null,[[0,11]])})))()]);case 26:b=t.sent;case 27:return t.abrupt("return",d?b:b.data);case 30:if(t.prev=30,t.t0=t.catch(5),h&&u){t.next=34;break}throw t.t0;case 34:return t.next=36,e.scanImage(r,{qrEngine:a,canvas:o,disallowCanvasResizing:s});case 36:return _=t.sent,t.abrupt("return",d?_:_.data);case 38:return t.prev=38,n||e._postWorkerMessage(a,"close"),t.finish(38);case 41:case"end":return t.stop()}}),t,null,[[5,30,38,41]])}))),function(e,t,r,n){return m.apply(this,arguments)})},{key:"createQrEngine",value:(y=l(c().mark((function t(n){var a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&console.warn("Specifying a worker path is not required and not supported anymore."),n=function(){return r.e(94149).then(r.bind(r,94149)).then((function(e){return e.createWorker()}))},t.t0=!e._disableBarcodeDetector&&"BarcodeDetector"in window&&BarcodeDetector.getSupportedFormats,!t.t0){t.next=7;break}return t.next=6,BarcodeDetector.getSupportedFormats();case 6:t.t0=t.sent.includes("qr_code");case 7:if(t.t0){t.next=9;break}return t.abrupt("return",n());case 9:if(a=navigator.userAgentData,t.t1=a&&a.brands.some((function(e){var t=e.brand;return/Chromium/i.test(t)}))&&/mac ?OS/i.test(a.platform),!t.t1){t.next=15;break}return t.next=14,a.getHighEntropyValues(["architecture","platformVersion"]).then((function(e){var t=e.architecture,r=e.platformVersion;return/arm/i.test(t||"arm")&&13<=parseInt(r||"13")})).catch((function(){return!0}));case 14:t.t1=t.sent;case 15:if(!t.t1){t.next=19;break}t.t2=n(),t.next=20;break;case 19:t.t2=new BarcodeDetector({formats:["qr_code"]});case 20:return t.abrupt("return",t.t2);case 21:case"end":return t.stop()}}),t)}))),function(e){return y.apply(this,arguments)})},{key:"_convertPoints",value:function(e,t){if(!t)return e;var r=t.x||0,a=t.y||0,i=t.width&&t.downScaledWidth?t.width/t.downScaledWidth:1;t=t.height&&t.downScaledHeight?t.height/t.downScaledHeight:1;var o,s=n(e);try{for(s.s();!(o=s.n()).done;){var c=o.value;c.x=c.x*i+r,c.y=c.y*t+a}}catch(u){s.e(u)}finally{s.f()}return e}},{key:"_stopVideoStream",value:function(e){var t,r=n(e.getTracks());try{for(r.s();!(t=r.n()).done;){var a=t.value;a.stop(),e.removeTrack(a)}}catch(i){r.e(i)}finally{r.f()}}},{key:"_drawToCanvas",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r=r||document.createElement("canvas");var a=t&&t.x?t.x:0,i=t&&t.y?t.y:0,o=t&&t.width?t.width:e.videoWidth||e.width,s=t&&t.height?t.height:e.videoHeight||e.height;return n||(n=t&&t.downScaledWidth?t.downScaledWidth:o,t=t&&t.downScaledHeight?t.downScaledHeight:s,r.width!==n&&(r.width=n),r.height!==t&&(r.height=t)),(t=r.getContext("2d",{alpha:!1})).imageSmoothingEnabled=!1,t.drawImage(e,a,i,o,s,0,0,r.width,r.height),[r,t]}},{key:"_loadImage",value:(p=l(c().mark((function t(r){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r instanceof Image)){t.next=4;break}return t.next=3,e._awaitImageLoad(r);case 3:return t.abrupt("return",r);case 4:if(!(r instanceof HTMLVideoElement||r instanceof HTMLCanvasElement||r instanceof SVGImageElement||"OffscreenCanvas"in window&&r instanceof OffscreenCanvas||"ImageBitmap"in window&&r instanceof ImageBitmap)){t.next=6;break}return t.abrupt("return",r);case 6:if(!(r instanceof File||r instanceof Blob||r instanceof URL||"string"==typeof r)){t.next=18;break}return(n=new Image).src=r instanceof File||r instanceof Blob?URL.createObjectURL(r):r.toString(),t.prev=9,t.next=12,e._awaitImageLoad(n);case 12:return t.abrupt("return",n);case 13:return t.prev=13,(r instanceof File||r instanceof Blob)&&URL.revokeObjectURL(n.src),t.finish(13);case 16:t.next=19;break;case 18:throw"Unsupported image type.";case 19:case"end":return t.stop()}}),t,null,[[9,,13,16]])}))),function(e){return p.apply(this,arguments)})},{key:"_awaitImageLoad",value:(v=l(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.complete&&0!==t.naturalWidth,e.t0){e.next=4;break}return e.next=4,new Promise((function(e,r){var n=function n(a){t.removeEventListener("load",n),t.removeEventListener("error",n),a instanceof ErrorEvent?r("Image load error"):e()};t.addEventListener("load",n),t.addEventListener("error",n)}));case 4:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"_postWorkerMessage",value:(u=l(c().mark((function t(r,n,a,i){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=e,t.next=3,r;case 3:return t.t1=t.sent,t.t2=n,t.t3=a,t.t4=i,t.abrupt("return",t.t0._postWorkerMessageSync.call(t.t0,t.t1,t.t2,t.t3,t.t4));case 8:case"end":return t.stop()}}),t)}))),function(e,t,r,n){return u.apply(this,arguments)})},{key:"_postWorkerMessageSync",value:function(t,r,n,a){if(!(t instanceof Worker))return-1;var i=e._workerMessageId++;return t.postMessage({id:i,type:r,data:n},a),i}}],o&&d(t.prototype,o),s&&d(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();v.DEFAULT_CANVAS_SIZE=400,v.NO_QR_CODE_FOUND="No QR code found",v._disableBarcodeDetector=!1,v._workerMessageId=0,t.default=v}}]);